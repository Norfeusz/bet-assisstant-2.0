# DOKUMENTACJA TECHNICZNA - BET ASSISTANT 2.0

**Data aktualizacji:** 30 grudnia 2025  
**Wersja:** 1.0 (Inicjalizacja projektu)

---

## 1. ARCHITEKTURA PROJEKTU

### 1.1 Struktura katalogÃ³w

```
D:\narzÄ™dzia\Bet Assistant 2.0\
â”œâ”€â”€ Dokumentacja/
â”‚   â”œâ”€â”€ Instrukcje - agenci/
â”‚   â”‚   â””â”€â”€ Migracja.txt          # Zadania do wykonania
â”‚   â”œâ”€â”€ dokumentacja techniczna     # Ten plik
â”‚   â”œâ”€â”€ instrukcja obsÅ‚ugi          # Przewodnik uÅ¼ytkownika
â”‚   â””â”€â”€ instrukcje dla agentÃ³w      # Workflow dla AI agentÃ³w
â”‚
â”œâ”€â”€ config/                        # Konfiguracja backendu
â”‚   â”œâ”€â”€ google-sheets-config.json # Google Sheets API
â”‚   â””â”€â”€ bet-conditions.json       # Warunki zakÅ‚adÃ³w
â”‚
â”œâ”€â”€ node_modules/                   # ZaleÅ¼noÅ›ci (nie w Git)
â”‚
â”œâ”€â”€ prisma/                        # Database schema (PostgreSQL)
â”‚   â”œâ”€â”€ schema.prisma             # Definicja schematu
â”‚   â””â”€â”€ migrations/               # Historia migracji DB
â”‚
â”œâ”€â”€ public/                         # Statyczne assety
â”‚   â””â”€â”€ (do dodania)
â”‚
â”œâ”€â”€ server/                        # Backend (Express + Prisma)
â”‚   â”œâ”€â”€ routes/                   # API endpoints
â”‚   â”‚   â”œâ”€â”€ analytics.ts         # /api/analytics/*
â”‚   â”‚   â”œâ”€â”€ import-jobs.ts       # /api/import-jobs/*
â”‚   â”‚   â”œâ”€â”€ strefa-typera.ts     # /api/strefa-typera/*
â”‚   â”‚   â””â”€â”€ verify-bets.ts       # /api/verify-bets/*
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/                  # Utility scripts
â”‚   â”‚   â”œâ”€â”€ backup-database.ts
â”‚   â”‚   â””â”€â”€ populate-leagues.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ src/                      # Backend source code
â”‚   â”‚   â”œâ”€â”€ db/                  # Prisma client
â”‚   â”‚   â”œâ”€â”€ models/              # Data models
â”‚   â”‚   â”œâ”€â”€ services/            # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ api-football-client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ data-importer.ts
â”‚   â”‚   â”‚   â””â”€â”€ league-selector.ts
â”‚   â”‚   â”œâ”€â”€ types/               # TypeScript types
â”‚   â”‚   â””â”€â”€ utils/               # Helper functions
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # Backend utilities
â”‚   â”‚   â”œâ”€â”€ backup-tables.ts
â”‚   â”‚   â””â”€â”€ bet-statistics.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ background-import-worker.ts  # Worker process
â”‚   â””â”€â”€ league-config-server.ts      # Main server file
â”‚
â”œâ”€â”€ src/                           # Frontend (React + TypeScript)
â”‚   â”œâ”€â”€ api/                       # Komunikacja z backendem
â”‚   â”‚   â””â”€â”€ client.ts             # Axios/Fetch client, base config
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                # ReuÅ¼ywalne komponenty React
â”‚   â”‚   â”œâ”€â”€ Layout.tsx            # GÅ‚Ã³wny layout z nawigacjÄ…
â”‚   â”‚   â””â”€â”€ Layout.module.css     # Style dla Layout
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                     # Custom React hooks
â”‚   â”‚   â””â”€â”€ (puste - do implementacji)
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                     # Strony aplikacji (routing)
â”‚   â”‚   â”œâ”€â”€ ImportPage.tsx        # ZakÅ‚adka Import
â”‚   â”‚   â”œâ”€â”€ DatabasePage.tsx      # ZakÅ‚adka Baza Danych
â”‚   â”‚   â”œâ”€â”€ BetFinderPage.tsx     # ZakÅ‚adka Wyszukiwarka TypÃ³w
â”‚   â”‚   â”œâ”€â”€ StrefaTyperaPage.tsx  # ZakÅ‚adka Strefa Typera
â”‚   â”‚   â””â”€â”€ AnalyticsPage.tsx     # ZakÅ‚adka Analityka
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                     # Zustand global state
â”‚   â”‚   â””â”€â”€ appStore.ts           # GÅ‚Ã³wny store aplikacji
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                    # Globalne style
â”‚   â”‚   â””â”€â”€ global.css            # CSS variables, resets, typography
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                     # TypeScript definicje
â”‚   â”‚   â””â”€â”€ index.ts              # GÅ‚Ã³wne typy aplikacji
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # Funkcje pomocnicze
â”‚   â”‚   â””â”€â”€ (puste - do implementacji)
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                    # Root component, routing setup
â”‚   â”œâ”€â”€ main.tsx                   # Entry point, React render
â”‚   â””â”€â”€ vite-env.d.ts             # Vite type definitions
â”‚
â”œâ”€â”€ stary/                         # Stary projekt (referencja - do usuniÄ™cia)
â”‚   â””â”€â”€ (caÅ‚y poprzedni kod)
â”‚
â”œâ”€â”€ .env                           # Environment variables (NIE w Git!)
â”œâ”€â”€ .gitignore                     # Git ignore rules
â”œâ”€â”€ index.html                     # HTML entry point
â”œâ”€â”€ package.json                   # Dependencies & scripts
â”œâ”€â”€ package-lock.json              # Lock file
â”œâ”€â”€ README-URUCHOMIENIE.md         # Instrukcja launcherÃ³w
â”œâ”€â”€ start.bat                      # Launcher frontendu
â”œâ”€â”€ start-all.bat                  # Launcher backend + frontend
â”œâ”€â”€ tsconfig.json                  # TypeScript config (frontend)
â”œâ”€â”€ tsconfig.node.json             # TypeScript config (Vite)
â”œâ”€â”€ tsconfig.server.json           # TypeScript config (backend)
â”œâ”€â”€ vite.config.ts                 # Vite configuration
â””â”€â”€ INSTRUKCJE_MIGRACJI.txt       # Plan migracji (z starego projektu)
```

---

## 2. SZCZEGÃ“ÅOWY OPIS PLIKÃ“W

### 2.1 Pliki konfiguracyjne (root)

#### `package.json`

**OdpowiedzialnoÅ›Ä‡:** Definicja projektu, dependencies, scripts
**Kluczowe zaleÅ¼noÅ›ci:**

```json
{
  "react": "18.3.1",
  "react-dom": "18.3.1",
  "react-router-dom": "6.30.2",
  "@tanstack/react-query": "5.90.15",
  "zustand": "5.0.9",
  "vite": "5.4.21",
  "typescript": "5.9.3"
}
```

**Scripts:**

- `npm run dev` - Uruchamia dev server (localhost:5173)
- `npm run build` - Build produkcyjny
- `npm run preview` - Preview buildu

#### `vite.config.ts`

**OdpowiedzialnoÅ›Ä‡:** Konfiguracja Vite
**Kluczowe elementy:**

```typescript
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      "/api": "http://localhost:3000", // Proxy do backendu
    },
  },
});
```

#### `tsconfig.json`

**OdpowiedzialnoÅ›Ä‡:** Konfiguracja TypeScript dla aplikacji
**Kluczowe opcje:**

- `strict: true` - ÅšcisÅ‚y mode
- `target: "ES2020"` - Target ES version
- `jsx: "react-jsx"` - JSX transform

---

### 2.2 Entry Points

#### `index.html`

**OdpowiedzialnoÅ›Ä‡:** HTML entry point
**Flow:**

1. Åaduje `<div id="root">`
2. Importuje `/src/main.tsx`

#### `src/main.tsx`

**OdpowiedzialnoÅ›Ä‡:** React render, providers setup
**Flow:**

1. Tworzy QueryClient (TanStack Query)
2. Renderuje App w `<StrictMode>`
3. Opakowuje w:
   - QueryClientProvider
   - BrowserRouter
4. Importuje `global.css`

**Kod:**

```typescript
ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <App />
      </BrowserRouter>
    </QueryClientProvider>
  </React.StrictMode>
);
```

#### `src/App.tsx`

**OdpowiedzialnoÅ›Ä‡:** Root component, routing
**Flow:**

1. Renderuje `<Layout>` (nawigacja + header)
2. Definiuje routes:
   - `/` â†’ BetFinderPage
   - `/import` â†’ ImportPage
   - `/database` â†’ DatabasePage
   - `/bet-finder` â†’ BetFinderPage
   - `/strefa-typera` â†’ StrefaTyperaPage
   - `/analytics` â†’ AnalyticsPage

---

### 2.3 Layout & Navigation

#### `src/components/Layout.tsx`

**OdpowiedzialnoÅ›Ä‡:** GÅ‚Ã³wna struktura UI
**Flow klikniÄ™cia w zakÅ‚adkÄ™:**

1. User klika zakÅ‚adkÄ™ (np. "ğŸ“¥ Import")
2. React Router zmienia URL (`/import`)
3. `<Routes>` w App.tsx renderuje ImportPage
4. Layout pozostaje (header + tabs)

**Struktura:**

```tsx
<div className={styles.layout}>
  <header className={styles.header}>
    <h1>âš½ Bet Assistant 2.0</h1>
  </header>

  <nav className={styles.tabs}>
    {tabs.map((tab) => (
      <Link to={tab.path} className={active ? styles.active : ""}>
        {tab.label}
      </Link>
    ))}
  </nav>

  <main className={styles.main}>
    {children} {/* Tu renderujÄ… siÄ™ strony */}
  </main>
</div>
```

**Tabs konfiguracja:**

```typescript
const tabs = [
  { path: "/import", label: "ğŸ“¥ Import" },
  { path: "/database", label: "ğŸ—„ï¸ Baza Danych" },
  { path: "/bet-finder", label: "ğŸ” Wyszukiwarka TypÃ³w" },
  { path: "/strefa-typera", label: "ğŸ“Š Strefa Typera" },
  { path: "/analytics", label: "ğŸ“ˆ Analityka" },
];
```

#### `src/components/Layout.module.css`

**OdpowiedzialnoÅ›Ä‡:** Style dla Layout
**Kluczowe klasy:**

- `.layout` - Flex container, min-height: 100vh
- `.header` - BiaÅ‚y background, padding, shadow
- `.tabs` - Flex row, gap, biaÅ‚y background
- `.tabButton` - Style zakÅ‚adek
- `.tabButton.active` - Gradient dla aktywnej zakÅ‚adki
- `.main` - GÅ‚Ã³wna zawartoÅ›Ä‡, flex: 1

---

### 2.4 Pages (Strony)

**Status:** Wszystkie strony sÄ… obecnie **placeholderami**

#### `src/pages/ImportPage.tsx`

**Obecny kod:**

```tsx
function ImportPage() {
  return (
    <div style={{ background: "white", padding: "40px", borderRadius: "12px" }}>
      <h2>ğŸ“¥ Import</h2>
      <p>FunkcjonalnoÅ›Ä‡ bÄ™dzie zmigrowana ze starego projektu</p>
    </div>
  );
}
```

**Do implementacji (z `stary/public/js/app.js`):**

- Lista krajÃ³w i lig
- WybÃ³r zakresu dat
- Przycisk "Import"
- Statystyki (liczba lig, meczÃ³w)
- Kolejka importu
- Background jobs display

#### `src/pages/DatabasePage.tsx`

**Do implementacji (z `stary/public/index.html` tab-database):**

- Panel filtrÃ³w (kraj, liga, druÅ¼yna)
- Search z autocomplete
- Tabela wynikÃ³w
- Modal szczegÃ³Å‚Ã³w meczu
- Limity (5, 10, 20, all)

#### `src/pages/BetFinderPage.tsx`

**Do implementacji (z `stary/public/js/bet-finder.js` - 5562 linii!):**

- Kontrolki (TOP wynikÃ³w, limit meczÃ³w, zakres dat)
- 15+ przyciskÃ³w wyszukiwania (grupy: Bramki, RoÅ¼ne, Spalone, etc.)
- SearchQueue panel
- Modal wynikÃ³w (uniwersalny)
- 15+ algorytmÃ³w analitycznych

#### `src/pages/StrefaTyperaPage.tsx`

**Do implementacji:**

- Backfill section
- Actions (accept, verify, create coupon)
- Watched matches modal
- Google Sheets integration

#### `src/pages/AnalyticsPage.tsx`

**Do implementacji (z `stary/public/analytics.html`):**

- Summary cards
- Filtry
- Wykresy (Chart.js?)
- Tabela statystyk
- Export funkcjonalnoÅ›Ä‡

---

### 2.5 API Layer

#### `src/api/client.ts`

**Obecny stan:** Plik istnieje ale jest pusty
**Do implementacji:**

```typescript
// Axios client z konfiguracjÄ…
const apiClient = axios.create({
  baseURL: "/api", // Proxy do localhost:3000
  timeout: 10000,
});

// Funkcje API
export const getLeagues = () => apiClient.get("/leagues");
export const getMatches = (filters) =>
  apiClient.get("/matches", { params: filters });
// ... etc
```

---

### 2.6 State Management

#### `src/store/appStore.ts`

**Obecny stan:** Plik istnieje ale jest pusty
**Do implementacji (Zustand):**

```typescript
interface AppState {
  // Globalne state (np. wybrane ligi, filtry)
  selectedLeagues: number[];
  dateRange: { from: string; to: string };
  // Actions
  setSelectedLeagues: (leagues: number[]) => void;
  setDateRange: (range) => void;
}

export const useAppStore = create<AppState>((set) => ({
  selectedLeagues: [],
  dateRange: { from: "", to: "" },
  setSelectedLeagues: (leagues) => set({ selectedLeagues: leagues }),
  // ...
}));
```

---

### 2.7 Types

#### `src/types/index.ts`

**Obecny stan:** Plik istnieje ale jest pusty
**Do implementacji:**

```typescript
// GÅ‚Ã³wne typy z backendu
export interface League {
  id: number;
  name: string;
  country: string;
  enabled: boolean;
}

export interface Match {
  id: number;
  homeTeam: string;
  awayTeam: string;
  date: string;
  league: League;
  // ... wiÄ™cej pÃ³l
}

export interface BetType {
  id: string;
  name: string;
  description: string;
  algorithm: string;
}

// ... etc
```

---

### 2.8 Styles

#### `src/styles/global.css`

**OdpowiedzialnoÅ›Ä‡:** Globalne style, CSS variables
**Zawiera:**

- CSS Reset (`* { margin: 0; padding: 0; }`)
- CSS Variables (kolory, czcionki)
- Body styles (gradient background)
- Utility classes (loading, spinner)

**CSS Variables:**

```css
:root {
  --primary: #667eea;
  --primary-dark: #5568d3;
  --secondary: #764ba2;
  --success: #48bb78;
  --danger: #f56565;
  --gray-100: #f3f4f6;
  --gray-600: #4b5563;
  --gray-900: #111827;
}
```

---

## 3. FLOW DANYCH

### 3.1 Render Flow (Startup)

```
index.html
  â””â”€> src/main.tsx
       â”œâ”€> QueryClientProvider setup
       â”œâ”€> BrowserRouter setup
       â””â”€> <App />
            â””â”€> <Layout>
                 â”œâ”€> Header
                 â”œâ”€> Navigation Tabs
                 â””â”€> <Routes>
                      â””â”€> Current Page Component
```

### 3.2 Navigation Flow

```
User clicks tab
  â””â”€> React Router <Link>
       â””â”€> URL changes (e.g. /import)
            â””â”€> <Routes> matches path
                 â””â”€> Renders ImportPage
                      â””â”€> Wrapped in Layout (persistent)
```

### 3.3 API Call Flow (do implementacji)

```
Component
  â””â”€> useQuery (TanStack Query)
       â””â”€> api/client.ts function
            â””â”€> Axios request
                 â””â”€> Vite proxy /api â†’ localhost:3000
                      â””â”€> Backend (Express)
                           â””â”€> Response
                                â””â”€> TanStack Query cache
                                     â””â”€> Component re-render
```

---

## 4. KLUCZOWE PLIKI DO MIGRACJI

### 4.1 Z starego projektu (`./stary/`)

**NajwaÅ¼niejsze ÅºrÃ³dÅ‚a:**

1. **`stary/public/js/bet-finder.js`** (5562 linii!)

   - 15+ algorytmÃ³w wyszukiwania
   - Search queue logic
   - Modal configuration
   - **â†’ MigrowaÄ‡ do:** `src/pages/BetFinderPage.tsx` + utils

2. **`stary/public/js/app.js`**

   - Import logic
   - League management
   - **â†’ MigrowaÄ‡ do:** `src/pages/ImportPage.tsx`

3. **`stary/public/js/watched-matches.js`**

   - Watched matches modal
   - **â†’ MigrowaÄ‡ do:** `src/components/WatchedMatches.tsx`

4. **`stary/public/js/search-queue.js`**

   - Search queue panel
   - **â†’ MigrowaÄ‡ do:** `src/hooks/useSearchQueue.ts`

5. **`stary/public/js/config/state.js`**

   - Global state
   - **â†’ MigrowaÄ‡ do:** `src/store/appStore.ts`

6. **`stary/public/js/api/*.js`**

   - API calls
   - **â†’ MigrowaÄ‡ do:** `src/api/client.ts`

7. **`stary/public/js/utils/*.js`**

   - Utility functions
   - **â†’ MigrowaÄ‡ do:** `src/utils/`

8. **`stary/public/css/*.css`**
   - Styles
   - **â†’ MigrowaÄ‡ do:** CSS Modules lub `global.css`

---

## 5. TECHNOLOGIE I BIBLIOTEKI

### 5.1 Core Stack

**React 18.3.1**

- Komponenty funkcyjne
- Hooks (useState, useEffect, custom hooks)
- JSX/TSX syntax

**TypeScript 5.9.3**

- Strict mode enabled
- Type safety dla wszystkich komponentÃ³w
- Interfaces dla danych z API

**Vite 5.4.21**

- Dev server (HMR - Hot Module Replacement)
- Build tool (Rollup pod spodem)
- Proxy `/api` â†’ `localhost:3000`

### 5.2 Routing & State

**React Router 6.30.2**

- `<BrowserRouter>` - client-side routing
- `<Routes>` + `<Route>` - Å›cieÅ¼ki
- `<Link>` - nawigacja
- `useLocation()` - aktywna zakÅ‚adka

**Zustand 5.0.9**

- Lightweight state management
- Prostsza alternatywa dla Redux
- `create()` - tworzenie store
- Hooks: `useAppStore()`

**TanStack Query 5.90.15**

- Server state management
- Auto caching
- Auto refetching
- `useQuery()` - fetch data
- `useMutation()` - POST/PUT/DELETE

### 5.3 Styling

**CSS Modules**

- Scoped CSS dla komponentÃ³w
- `import styles from './Component.module.css'`
- `className={styles.button}`

**Global CSS**

- CSS Variables (`--primary`, etc.)
- Reset styles
- Typography

---

## 6. BACKEND API I WORKER

**Lokalizacja:** `server/` (skopiowany ze `stary/`)
**Base URL:** `http://localhost:3000`
**Proxy:** Vite przekierowuje `/api/*` â†’ `localhost:3000`
**Status:** âœ… NiezaleÅ¼ny od folderu `stary/`

### 6.1 Architektura Backend

Backend skÅ‚ada siÄ™ z **3 procesÃ³w**:

1. **Express Server** (`league-config-server.ts`) - HTTP API
2. **Import Worker** (`background-import-worker.ts`) - Przetwarzanie zadaÅ„ importu w tle
3. **PostgreSQL Database** (Prisma)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (React)  â”‚
â”‚  localhost:5173     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ /api/* requests
           â”‚ (proxied by Vite)
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Express Server     â”‚â—„â”€â”€â”€â”€â”€â”€â”¤  Import Worker       â”‚
â”‚  localhost:3000     â”‚       â”‚  (Background)        â”‚
â”‚  (API endpoints)    â”‚       â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â”‚  Prisma ORM                 â”‚  Prisma ORM
           â”‚                             â”‚
           â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL Database                      â”‚
â”‚  (import_jobs, matches, leagues, ...)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘
           â”‚ API calls
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API-Football.com   â”‚
â”‚  (External API)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Import Worker - Jak dziaÅ‚a?

**Plik:** `server/background-import-worker.ts` (588 linii)
**OdpowiedzialnoÅ›Ä‡:** Przetwarzanie zadaÅ„ importu w tle

#### Lifecycle:

1. **Start:** Worker startuje i od razu sprawdza zadania
2. **Check Loop:** Co 5 minut sprawdza bazÄ™ w poszukiwaniu zadaÅ„ do przetworzenia
3. **Job Processing:** Przetwarza **jedno zadanie na raz** (lock: `processingJobId`)
4. **Auto Resume:** Po zakoÅ„czeniu zadania natychmiast sprawdza kolejne (nie czeka 5 minut)

#### Priorytety zadaÅ„:

```sql
-- Worker wybiera zadania w kolejnoÅ›ci:
1. rate_limited jobs (rate_limit_reset_at < NOW()) -- NajwyÅ¼szy priorytet
2. pending jobs (jeÅ›li brak running/rate_limited)  -- NiÅ¼szy priorytet
```

#### Flow przetwarzania:

```
Worker.checkAndProcessJobs()
  â”‚
  â”œâ”€> SprawdÅº lock (processingJobId)
  â”‚   â””â”€> JeÅ›li zajÄ™ty â†’ skip
  â”‚
  â”œâ”€> Query SQL: znajdÅº zadanie do przetworzenia
  â”‚   â””â”€> rate_limited (ready) OR pending (if no active jobs)
  â”‚
  â”œâ”€> Ustaw lock (processingJobId = job.id)
  â”‚
  â”œâ”€> processJob(job)
  â”‚   â”‚
  â”‚   â”œâ”€> Dla kaÅ¼dej ligi:
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€> Dla kaÅ¼dej daty w zakresie:
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â”œâ”€> ApiFootballClient.getFixtures()
  â”‚   â”‚   â”‚   â”‚   â””â”€> GET api-football.com/v3/fixtures
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â”œâ”€> Rate limit check
  â”‚   â”‚   â”‚   â”‚   â””â”€> JeÅ›li 429 â†’ status='rate_limited', rate_limit_reset_at = +1h
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â””â”€> DataImporter.processFixtures()
  â”‚   â”‚   â”‚       â””â”€> INSERT/UPDATE matches w PostgreSQL
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€> Oznacz ligÄ™ jako completed
  â”‚   â”‚
  â”‚   â”œâ”€> Status update: 'completed' lub 'failed'
  â”‚   â”‚
  â”‚   â””â”€> DatabaseBackup.autoBackup() (jeÅ›li job_type = new_matches)
  â”‚
  â”œâ”€> Zwolnij lock (processingJobId = null)
  â”‚
  â””â”€> setImmediate(() => checkAndProcessJobs())  // SprawdÅº kolejne zadanie NATYCHMIAST
```

#### Rate Limiting:

Worker obsÅ‚uguje limity API:

- **API-Football limit:** 100 requestÃ³w / dzieÅ„ (darmowy plan)
- **Rate limit detection:** HTTP 429 response
- **Auto resume:** Worker zapisuje `rate_limit_reset_at = NOW() + 1 hour`
- **Next check:** Worker sprawdza co 5 minut czy `rate_limit_reset_at < NOW()`
- **Resume:** Automatycznie wznawia zadanie po upÅ‚ywie czasu

#### Logging:

- **Console:** Real-time logs w terminalu
- **File:** `logs/import-YYYY-MM-DD.log`
- **Email:** Powiadomienia o zakoÅ„czeniu/bÅ‚Ä™dzie (jeÅ›li SMTP skonfigurowane)

#### PrzykÅ‚adowe logi:

```
ğŸš€ Background Import Worker started
ğŸ“ Logs directory: D:\narzÄ™dzia\Bet Assistant 2.0\logs
â° Checking for jobs every 5 minutes...

ğŸ” Checking for pending jobs...
âœ… Found job #12 to process
ğŸ“ Processing job #12 (new_matches)
  ğŸ† League: Premier League (39)
    ğŸ“… 2025-01-01: 5 fixtures imported
    ğŸ“… 2025-01-02: 3 fixtures imported
  âœ… League completed (39)
  ğŸ† League: La Liga (140)
    ğŸ“… 2025-01-01: 4 fixtures imported
    â¸ï¸  Rate limit hit! Reset at: 2025-12-30 17:00:00
ğŸ’¾ Job #12 paused (rate_limited)
ğŸ” Job finished, checking for next job in queue...
ğŸ’¤ No jobs to process
```

#### Uruchomienie:

```bash
# Osobno (terminal)
npm run server:worker

# Razem z backendem i frontendem
start-all.bat  # Uruchamia wszystkie 3 procesy

# Tylko worker
scripts\start-worker.bat
```

### 6.3 Struktura API:

**Import Jobs:**

- `GET /api/import-jobs` - lista zadaÅ„ importu
  - Query params: `showHidden=true/false`
  - Response: `ImportJob[]`
- `POST /api/import-jobs` - utwÃ³rz nowe zadanie
  - Body: `{ leagueIds: number[], dateFrom: string, dateTo: string, jobType: 'new_matches' | 'update_results' }`
  - Response: `{ success: true, jobId: number }`
- `DELETE /api/import-jobs/:id` - usuÅ„ zadanie
- `POST /api/import-jobs/:id/retry` - ponÃ³w prÃ³bÄ™ zadania
- `POST /api/import-jobs/:id/clone` - sklonuj zadanie

**Import Job Schema:**

```typescript
interface ImportJob {
  id: number;
  leagues: number[]; // Array league IDs
  date_from: string; // YYYY-MM-DD
  date_to: string; // YYYY-MM-DD
  job_type: "new_matches" | "update_results";
  status:
    | "in_queue"
    | "pending"
    | "running"
    | "paused"
    | "completed"
    | "failed"
    | "rate_limited";
  progress: {
    current_league?: number;
    current_date?: string;
    completed_leagues?: number[]; // Array completed league IDs
  };
  total_matches: number;
  imported_matches: number;
  failed_matches: number;
  rate_limit_remaining: number;
  rate_limit_reset_at: string | null; // ISO timestamp
  error_message?: string;
  created_at: string; // ISO timestamp
  started_at?: string;
}
```

**Config:**

- `GET /api/config` - konfiguracja aplikacji
  - Response: `{ leagues: League[], conditions: BetCondition[] }`

### 6.4 Services (Backend Logic)

#### `server/src/services/api-football-client.ts`

**OdpowiedzialnoÅ›Ä‡:** Komunikacja z API-Football.com
**Kluczowe metody:**

- `getFixtures(date, leagueId, season)` - pobiera mecze
- `getFixtureStatistics(fixtureId)` - pobiera statystyki meczu
- `getFixtureEvents(fixtureId)` - pobiera wydarzenia (bramki, kartki)
- `getH2H(team1, team2)` - head-to-head statystyki

**Rate limiting:**

- Limit: 100 requestÃ³w/dzieÅ„ (darmowy plan)
- Detection: HTTP 429 response
- Handling: Worker pausuje zadanie na 1 godzinÄ™

#### `server/src/services/data-importer.ts`

**OdpowiedzialnoÅ›Ä‡:** Przetwarzanie i zapis danych do bazy
**Flow:**

1. Odbiera fixtures z API-Football
2. Transformuje dane (mapping)
3. INSERT/UPDATE w PostgreSQL (przez Prisma)
4. Zwraca statystyki (imported, failed)

#### `server/src/services/league-selector.ts`

**OdpowiedzialnoÅ›Ä‡:** ZarzÄ…dzanie ligami
**Funkcje:**

- `getEnabledLeagues()` - pobiera aktywne ligi
- `enableLeague(leagueId)` - wÅ‚Ä…cza ligÄ™
- `disableLeague(leagueId)` - wyÅ‚Ä…cza ligÄ™

### 6.5 Tech Stack (backend):

- **Express 5.1.0** - serwer HTTP
- **Prisma 6.18.0** - ORM
- **PostgreSQL** - baza danych
- **Node.js 24.11.1** - runtime
- **tsx** - TypeScript execution
- **nodemon** - auto-reload podczas development
- **dotenv** - zmienne Å›rodowiskowe
- **googleapis** - Google Sheets integration
- **nodemailer** - email notifications

### 6.6 Pliki konfiguracyjne:

- `.env` - zmienne Å›rodowiskowe
  ```env
  DATABASE_URL="postgresql://..."
  API_FOOTBALL_KEY="your_key"
  SMTP_HOST="smtp.gmail.com"
  SMTP_USER="your_email"
  SMTP_PASS="your_password"
  ```
- `config/google-sheets-config.json` - konfiguracja Google Sheets API
- `config/bet-conditions.json` - warunki zakÅ‚adÃ³w
- `prisma/schema.prisma` - schema bazy danych

### 6.7 Scripts npm (Backend):

```json
{
  "server": "nodemon --exec npx tsx server/league-config-server.ts",
  "server:worker": "npx tsx server/background-import-worker.ts",
  "db:generate": "prisma generate",
  "db:studio": "prisma studio",
  "db:migrate": "prisma migrate dev"
}
```

---

## 7. LAUNCHERS (Uruchomienie)

### 7.1 start-all.bat (Recommended)

**Lokalizacja:** Root projektu
**Uruchamia:** Backend Server + Import Worker + Frontend (Vite)

```bash
start-all.bat
```

**Flow:**

1. Sprawdza czy backend juÅ¼ dziaÅ‚a (localhost:3000)
2. JeÅ›li nie â†’ Uruchamia backend w nowym oknie terminala
3. Uruchamia worker w osobnym oknie terminala
4. Czeka 2 sekundy
5. Uruchamia frontend (Vite) w bieÅ¼Ä…cym oknie
6. Po 3 sekundach otwiera przeglÄ…darkÄ™ (localhost:5173)

**Rezultat:** 3 okna terminala:

- **Backend Server** - Express API (localhost:3000)
- **Import Worker** - Background jobs processor
- **Frontend** - Vite dev server (localhost:5173)

### 7.2 scripts\start.bat (Frontend only)

**Lokalizacja:** `scripts/start.bat`
**Uruchamia:** Tylko frontend (Vite)

```bash
scripts\start.bat
```

**UÅ¼ycie:** Gdy backend i worker juÅ¼ dziaÅ‚ajÄ… osobno

### 7.3 scripts\start-worker.bat (Worker only)

**Lokalizacja:** `scripts/start-worker.bat`
**Uruchamia:** Tylko import worker

```bash
scripts\start-worker.bat
```

**UÅ¼ycie:** Gdy chcesz uruchomiÄ‡ tylko worker (np. na serwerze produkcyjnym)

### 7.4 RÄ™czne uruchomienie (Development)

```bash
# Terminal 1: Backend Server
npm run server

# Terminal 2: Import Worker
npm run server:worker

# Terminal 3: Frontend
npm run dev
```

---

## 8. DEVELOPMENT WORKFLOW

### 8.1 Uruchomienie projektu (Development)

**Opcja 1: Wszystko naraz (Recommended)**

```bash
cd "D:\narzÄ™dzia\Bet Assistant 2.0"
start-all.bat
```

**Rezultat:**

- Backend API: `http://localhost:3000`
- Import Worker: Background process
- Frontend: `http://localhost:5173` (auto-open w przeglÄ…darce)

**Opcja 2: RÄ™cznie (3 terminale)**

```bash
# Terminal 1: Backend
npm run server

# Terminal 2: Worker
npm run server:worker

# Terminal 3: Frontend
npm run dev
```

### 8.2 Build produkcyjny

```bash
npm run build
```

**Rezultat:** Pliki w folderze `/dist`

### 8.3 Preview buildu

```bash
npm run preview
```

### 8.4 TypeScript check

```bash
npx tsc --noEmit
```

### 8.5 Praca z bazÄ… danych

**Prisma Studio (GUI):**

```bash
npm run db:studio
```

**Migracje:**

```bash
npm run db:migrate
```

**Regeneracja Prisma Client:**

```bash
npm run db:generate
```

---

## 9. GIT & GITHUB

**Repository:** https://github.com/Norfeusz/bet-assisstant-2.0.git  
**Branch:** main

### Struktura commitÃ³w:

```
feat: dodaj nowÄ… funkcjonalnoÅ›Ä‡
fix: napraw bug
refactor: refaktoryzacja
docs: aktualizacja dokumentacji
style: formatowanie
```

---

## 10. PLAN IMPLEMENTACJI (Etapy)

**Status:** âœ… Etap 0 - Setup (ukoÅ„czony), â³ Krok 2 - Import Page (w trakcie)

### âœ… Krok 1: Launcher (UKOÅƒCZONY)

- âœ… `start-all.bat` - uruchamia backend + worker + frontend
- âœ… `scripts/start.bat` - uruchamia tylko frontend
- âœ… `scripts/start-worker.bat` - uruchamia tylko worker
- âœ… Backend zmigrowany do `server/`
- âœ… Prisma schema i migracje skopiowane
- âœ… Wszystkie pliki konfiguracyjne (.env, config/)

### â³ Krok 2: Import Page (W TRAKCIE)

- âœ… `src/pages/ImportPage.tsx` - komponent React z peÅ‚nÄ… funkcjonalnoÅ›ciÄ…
- âœ… `src/pages/ImportPage.module.css` - stylowanie CSS Modules
- âœ… Funkcje:
  - Modal do tworzenia zadania (wybÃ³r lig, zakres dat, typ zadania)
  - Lista zadaÅ„ z auto-refresh (co 5s)
  - Statusy zadaÅ„ z kolorami
  - Paski postÄ™pu dla aktywnych zadaÅ„
  - Toggle ukrytych/aktywnych zadaÅ„
  - ObsÅ‚uga bÅ‚Ä™dÃ³w i rate limitÃ³w
- âœ… **Krok 3: ObsÅ‚uga aktywnego zadania**
  - Przyciski akcji: Wstrzymaj, WznÃ³w, ZakoÅ„cz
  - Integracja z API: `/api/import-jobs/:id/pause`, `/resume`, `/delete`
  - Walidacja statusÃ³w (pokazuj odpowiednie przyciski dla kaÅ¼dego statusu)
- âœ… **Krok 4: Masowe operacje i ukrywanie**
  - Checkbox przy kaÅ¼dym zadaniu + "Zaznacz wszystkie"
  - Przycisk "UsuÅ„" dla zadaÅ„ w kolejce (in_queue, pending)
  - Przycisk "Ukryj" dla zadaÅ„ zakoÅ„czonych (completed, failed)
  - Akcje masowe: "UsuÅ„ zaznaczone", "Ukryj zaznaczone"
  - Funkcje: `hideJob()`, `deleteJob()`, `toggleJobSelection()`, `toggleSelectAll()`
- âœ… **Krok 5: Przyciski szybkiego wyboru dat**
  - Funkcja `setDatePreset()` z 8 presetami
  - Dni: przedwczoraj, wczoraj, dzisiaj, jutro, pojutrze
  - Tygodnie: poprzedni, obecny, nastÄ™pny (poniedziaÅ‚ek-niedziela)
  - UI: grid 5 kolumn, przyciski tygodniowe szersze (span 2)
  - Style: btnPreset (szary), btnPresetWide (niebieski)
- ğŸ”² Testy funkcjonalnoÅ›ci (do wykonania po uruchomieniu)

### ğŸ“‹ NastÄ™pne kroki (z Migracja.txt):

- Krok 3: ZakÅ‚adka - Baza Danych
- Krok 4: ZakÅ‚adka - Wyszukiwarka TypÃ³w (Bet Finder)
- Krok 5: ZakÅ‚adka - Strefa Typera
- Krok 6: ZakÅ‚adka - Analityka
- Krok 7-10: Infrastruktura, komponenty wspÃ³Å‚dzielone, polish

---

## 11. AKTUALIZACJE

**30 grudnia 2025 - 15:56:**

- âœ… Inicjalizacja projektu (Vite + React + TypeScript)
- âœ… Setup routing (5 stron z placeholderami)
- âœ… Layout z nawigacjÄ…
- âœ… Git + GitHub integration
- âœ… Dokumentacja (3 pliki)

**30 grudnia 2025 - 16:30:**

- âœ… **Launcher** - start.bat i start-all.bat
- âœ… **Backend skopiowany** ze `stary/` do `server/`
- âœ… **Prisma** - schema i migracje skopiowane
- âœ… **Config** - .env i config/ skopiowane
- âœ… **Dependencies** - backend packages zainstalowane
- âœ… **Backend dziaÅ‚a** niezaleÅ¼nie na localhost:3000

**30 grudnia 2025 - 17:45:**

- âœ… **Import Worker** - zintegrowany z start-all.bat
- âœ… **ImportPage.tsx** - peÅ‚na implementacja React
- âœ… **Dokumentacja** - rozbudowana o worker i import flow
- âœ… **scripts/start-worker.bat** - osobny launcher dla workera

**30 grudnia 2025 - 18:30:**

- âœ… **Bugfix: Worker** - naprawiono import path `../db.js` â†’ `../db/index.js`
- âœ… **Bugfix: Worker** - zamieniono `require.main` na ES module check w backup-database.ts
- âœ… **Bugfix: Worker** - naprawiono formatowanie w metodzie `start()` (setInterval)
- âœ… **Krok 3: ObsÅ‚uga aktywnego zadania**
  - Dodano funkcje: `pauseJob()`, `resumeJob()`, `cancelJob()`
  - Dodano przyciski akcji w kartach zadaÅ„
  - Style dla przyciskÃ³w (btnAction, btnActionDanger)
  - Warunkowe wyÅ›wietlanie przyciskÃ³w wedÅ‚ug statusu zadania

**30 grudnia 2025 - 19:00:**

- âœ… **Krok 4: Masowe operacje i ukrywanie zadaÅ„**
  - Stan `selectedJobs` dla zaznaczonych zadaÅ„
  - Toolbar z checkboxem "Zaznacz wszystkie" i licznikiem
  - Funkcje: `hideJob()`, `deleteJob()`, `hideSelectedJobs()`, `deleteSelectedJobs()`
  - UI: checkbox przy kaÅ¼dym zadaniu, przyciski masowe w toolbar
  - Przyciski indywidualne: "UsuÅ„" (kolejka), "Ukryj" (zakoÅ„czone)
  - Style: toolbar, selectAllLabel, btnBulkDelete, btnBulkHide, jobCheckbox

**30 grudnia 2025 - 19:15:**

- âœ… **Krok 5: Przyciski szybkiego wyboru dat**
  - Funkcja `setDatePreset()` - obsÅ‚uga 8 presetÃ³w
  - Presety dni: przedwczoraj, wczoraj, dzisiaj, jutro, pojutrze
  - Presety tygodni: poprzedni, obecny, nastÄ™pny (poniedziaÅ‚ek-niedziela)
  - Logika kalkulacji dat z uwzglÄ™dnieniem poniedziaÅ‚ku jako pierwszego dnia tygodnia
  - UI: grid layout 5 kolumn, przyciski dzienne (1 kolumna), tygodniowe (2 kolumny)
  - Style: btnPreset (szary), btnPresetWide (niebieski z ikonami)

**30 grudnia 2025 - 20:00:**

- âœ… **Krok 6: Kalendarz z informacjÄ… o zaimportowanych meczach**
  - Dodano funkcjÄ™ `renderCalendar()` z nawigacjÄ… miesiÄ…c w miesiÄ…c
  - Click-to-select: klikniÄ™cie dnia wypeÅ‚nia dateFrom/dateTo
  - Color coding: biaÅ‚e (brak), niebieskie (new_matches), zielone (update_results)
  - Modal z kalendarzem i legendÄ… kolorÃ³w
  - Analiza wszystkich zadaÅ„ (visible + hidden) dla dokÅ‚adnoÅ›ci
  - Funkcja `formatLocalDate()` - unika problemÃ³w z UTC timezone

**31 grudnia 2025 - 12:00:**

- âœ… **Krok 7-8: Wyszukiwarka TypÃ³w - Struktura i UI**
  - Utworzono `BetFinderPage.tsx` (420 linii) - peÅ‚na struktura React
  - Utworzono `BetFinderPage.module.css` (450 linii) - kompletny styling
  - **Krok 7 - Zaimplementowane elementy:**
    - Liczba najlepszych wynikÃ³w (TOP 5/10/15/20)
    - Liczba meczÃ³w do analizy (5/10/15/20/30/50/Wszystkie)
    - Zakres dat nadchodzÄ…cych meczÃ³w (date picker + 3 presety)
    - Button "Automatycznie dodaj typy" (otwiera modal)
    - Kolejka wyszukiwaÅ„ (struktura UI, pusta na start)
  - **Krok 8 - Modal z typami (z zachowaniem grupowania):**
    - **Grupa 1: Rezultat** - Wygrane vs Przegrane
    - **Grupa 2: Bramki** - 6 typÃ³w (NajwiÄ™cej bramek, Najmniej bramek, Przewaga bramkowa, Handicap 1.5, NajwiÄ™cej BTS, Bez BTS)
    - **Grupa 3: RoÅ¼ne** - 4 typy (WYKLUCZONO: najwiÄ™cej/najmniej roÅ¼nych pojedynczo)
    - **Grupa 4: Dom/Wyjazd** - 4 typy (Przewaga gospodarzy, Przewaga goÅ›ci, Bramki gospodarzy, Bramki goÅ›ci)
  - Stan aplikacji: topCount, matchCount, dateFrom, dateTo, searchQueue, selectedBetTypes
  - Funkcje pomocnicze: formatDate(), setTodayDate(), setTomorrowDate(), setDayAfterTomorrowDate()
  - UI: Checkboxy w modalu, licznik wybranych typÃ³w, przycisk "Dodaj do kolejki"
  - **TODO dla nowego agenta:** Implementacja logiki wyszukiwania i kolejki (backend + algorytmy)

**NastÄ™pny krok:** Przekazanie projektu do nowego agenta dla implementacji logiki wyszukiwania

---

## 12. NOTATKI TECHNICZNE

### Performance considerations:

- React.memo dla czÄ™sto renderowanych komponentÃ³w
- useMemo / useCallback dla drogich obliczeÅ„
- Code splitting (React.lazy) dla stron
- TanStack Query caching dla API calls

### Security considerations:

- Backend obsÅ‚uguje auth (jeÅ›li jest)
- Frontend nie przechowuje sensitywnych danych
- HTTPS w produkcji

### Browser support:

- Modern browsers (Chrome, Firefox, Edge, Safari)
- ES2020+ features
- No IE11 support

---

**Ostatnia aktualizacja:** 30 grudnia 2025  
**Autor dokumentacji:** AI Agent (Migracja)
