# DOKUMENTACJA TECHNICZNA - BET ASSISTANT 2.0

**Data aktualizacji:** 14 lutego 2026  
**Wersja:** 1.3 (Database Browser - Full CRUD Operations)

---

## 1. ARCHITEKTURA PROJEKTU

### 1.1 Struktura katalogÃ³w

```
D:\narzÄ™dzia\Bet Assistant 2.0\
â”œâ”€â”€ Dokumentacja/
â”‚   â”œâ”€â”€ Instrukcje - agenci/
â”‚   â”‚   â””â”€â”€ Migracja.txt          # Zadania do wykonania
â”‚   â”œâ”€â”€ dokumentacja techniczna     # Ten plik
â”‚   â”œâ”€â”€ instrukcja obsÅ‚ugi          # Przewodnik uÅ¼ytkownika
â”‚   â””â”€â”€ instrukcje dla agentÃ³w      # Workflow dla AI agentÃ³w
â”‚
â”œâ”€â”€ config/                        # Konfiguracja backendu
â”‚   â”œâ”€â”€ google-sheets-config.json # Google Sheets API
â”‚   â””â”€â”€ bet-conditions.json       # Warunki zakÅ‚adÃ³w
â”‚
â”œâ”€â”€ node_modules/                   # ZaleÅ¼noÅ›ci (nie w Git)
â”‚
â”œâ”€â”€ prisma/                        # Database schema (PostgreSQL)
â”‚   â”œâ”€â”€ schema.prisma             # Definicja schematu
â”‚   â””â”€â”€ migrations/               # Historia migracji DB
â”‚
â”œâ”€â”€ public/                         # Statyczne assety
â”‚   â””â”€â”€ (do dodania)
â”‚
â”œâ”€â”€ server/                        # Backend (Express + Prisma)
â”‚   â”œâ”€â”€ routes/                   # API endpoints
â”‚   â”‚   â”œâ”€â”€ analytics.ts         # /api/analytics/*
â”‚   â”‚   â”œâ”€â”€ import-jobs.ts       # /api/import-jobs/*
â”‚   â”‚   â”œâ”€â”€ strefa-typera.ts     # /api/strefa-typera/*
â”‚   â”‚   â”œâ”€â”€ verify-bets.ts       # /api/verify-bets/*
â”‚   â”‚   â”œâ”€â”€ bet-finder.ts        # âœ… /api/bet-finder/*
â”‚   â”‚   â””â”€â”€ database.ts          # âœ… /api/database/* (Database Browser)
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/                  # Utility scripts
â”‚   â”‚   â”œâ”€â”€ backup-database.ts
â”‚   â”‚   â””â”€â”€ populate-leagues.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ src/                      # Backend source code
â”‚   â”‚   â”œâ”€â”€ db/                  # Prisma client
â”‚   â”‚   â”œâ”€â”€ models/              # Data models
â”‚   â”‚   â”œâ”€â”€ services/            # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ api-football-client.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ data-importer.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ league-selector.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ bet-finder-algorithms.ts  # âœ… Algorytmy wyszukiwania
â”‚   â”‚   â”‚   â”œâ”€â”€ bet-finder-service.ts     # âœ… ZarzÄ…dzanie kolejkÄ…
â”‚   â”‚   â”‚   â””â”€â”€ database-browser.ts       # âœ… Universal PostgreSQL Browser
â”‚   â”‚   â”œâ”€â”€ types/               # TypeScript types
â”‚   â”‚   â””â”€â”€ utils/               # Helper functions
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # Backend utilities
â”‚   â”‚   â”œâ”€â”€ backup-tables.ts
â”‚   â”‚   â””â”€â”€ bet-statistics.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ background-import-worker.ts  # Worker process
â”‚   â””â”€â”€ league-config-server.ts      # Main server file
â”‚
â”œâ”€â”€ src/                           # Frontend (React + TypeScript)
â”‚   â”œâ”€â”€ api/                       # Komunikacja z backendem
â”‚   â”‚   â””â”€â”€ client.ts             # Axios/Fetch client, base config
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                # ReuÅ¼ywalne komponenty React
â”‚   â”‚   â”œâ”€â”€ Layout.tsx            # GÅ‚Ã³wny layout z nawigacjÄ…
â”‚   â”‚   â””â”€â”€ Layout.module.css     # Style dla Layout
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                     # Custom React hooks
â”‚   â”‚   â””â”€â”€ (puste - do implementacji)
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                     # Strony aplikacji (routing)
â”‚   â”‚   â”œâ”€â”€ ImportPage.tsx        # ZakÅ‚adka Import
â”‚   â”‚   â”œâ”€â”€ DatabasePage.tsx      # âœ… ZakÅ‚adka Baza Danych (Universal PostgreSQL Browser)
â”‚   â”‚   â”œâ”€â”€ DatabasePage.module.css  # âœ… Style dla Database Browser
â”‚   â”‚   â”œâ”€â”€ BetFinderPage.tsx     # ZakÅ‚adka Wyszukiwarka TypÃ³w
â”‚   â”‚   â”œâ”€â”€ StrefaTyperaPage.tsx  # ZakÅ‚adka Strefa Typera
â”‚   â”‚   â””â”€â”€ AnalyticsPage.tsx     # ZakÅ‚adka Analityka
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                     # Zustand global state
â”‚   â”‚   â””â”€â”€ appStore.ts           # GÅ‚Ã³wny store aplikacji
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                    # Globalne style
â”‚   â”‚   â””â”€â”€ global.css            # CSS variables, resets, typography
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                     # TypeScript definicje
â”‚   â”‚   â””â”€â”€ index.ts              # GÅ‚Ã³wne typy aplikacji
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                     # Funkcje pomocnicze
â”‚   â”‚   â””â”€â”€ (puste - do implementacji)
â”‚   â”‚
â”‚   â”œâ”€â”€ App.tsx                    # Root component, routing setup
â”‚   â”œâ”€â”€ main.tsx                   # Entry point, React render
â”‚   â””â”€â”€ vite-env.d.ts             # Vite type definitions
â”‚
â”œâ”€â”€ stary/                         # Stary projekt (referencja - do usuniÄ™cia)
â”‚   â””â”€â”€ (caÅ‚y poprzedni kod)
â”‚
â”œâ”€â”€ .env                           # Environment variables (NIE w Git!)
â”œâ”€â”€ .gitignore                     # Git ignore rules
â”œâ”€â”€ index.html                     # HTML entry point
â”œâ”€â”€ package.json                   # Dependencies & scripts
â”œâ”€â”€ package-lock.json              # Lock file
â”œâ”€â”€ README-URUCHOMIENIE.md         # Instrukcja launcherÃ³w
â”œâ”€â”€ start.bat                      # Launcher frontendu
â”œâ”€â”€ start-all.bat                  # Launcher backend + frontend
â”œâ”€â”€ tsconfig.json                  # TypeScript config (frontend)
â”œâ”€â”€ tsconfig.node.json             # TypeScript config (Vite)
â”œâ”€â”€ tsconfig.server.json           # TypeScript config (backend)
â”œâ”€â”€ vite.config.ts                 # Vite configuration
â””â”€â”€ INSTRUKCJE_MIGRACJI.txt       # Plan migracji (z starego projektu)
```

---

## 2. SZCZEGÃ“ÅOWY OPIS PLIKÃ“W

### 2.1 Pliki konfiguracyjne (root)

#### `package.json`

**OdpowiedzialnoÅ›Ä‡:** Definicja projektu, dependencies, scripts
**Kluczowe zaleÅ¼noÅ›ci:**

```json
{
  "react": "18.3.1",
  "react-dom": "18.3.1",
  "react-router-dom": "6.30.2",
  "@tanstack/react-query": "5.90.15",
  "zustand": "5.0.9",
  "vite": "5.4.21",
  "typescript": "5.9.3"
}
```

**Scripts:**

- `npm run dev` - Uruchamia dev server (localhost:5173)
- `npm run build` - Build produkcyjny
- `npm run preview` - Preview buildu

#### `vite.config.ts`

**OdpowiedzialnoÅ›Ä‡:** Konfiguracja Vite
**Kluczowe elementy:**

```typescript
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      "/api": "http://localhost:3000", // Proxy do backendu
    },
  },
});
```

#### `tsconfig.json`

**OdpowiedzialnoÅ›Ä‡:** Konfiguracja TypeScript dla aplikacji
**Kluczowe opcje:**

- `strict: true` - ÅšcisÅ‚y mode
- `target: "ES2020"` - Target ES version
- `jsx: "react-jsx"` - JSX transform

---

### 2.2 Entry Points

#### `index.html`

**OdpowiedzialnoÅ›Ä‡:** HTML entry point
**Flow:**

1. Åaduje `<div id="root">`
2. Importuje `/src/main.tsx`

#### `src/main.tsx`

**OdpowiedzialnoÅ›Ä‡:** React render, providers setup
**Flow:**

1. Tworzy QueryClient (TanStack Query)
2. Renderuje App w `<StrictMode>`
3. Opakowuje w:
   - QueryClientProvider
   - BrowserRouter
4. Importuje `global.css`

**Kod:**

```typescript
ReactDOM.createRoot(document.getElementById("root")!).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <App />
      </BrowserRouter>
    </QueryClientProvider>
  </React.StrictMode>
);
```

#### `src/App.tsx`

**OdpowiedzialnoÅ›Ä‡:** Root component, routing
**Flow:**

1. Renderuje `<Layout>` (nawigacja + header)
2. Definiuje routes:
   - `/` â†’ BetFinderPage
   - `/import` â†’ ImportPage
   - `/database` â†’ DatabasePage
   - `/bet-finder` â†’ BetFinderPage
   - `/strefa-typera` â†’ StrefaTyperaPage
   - `/analytics` â†’ AnalyticsPage

---

### 2.3 Layout & Navigation

#### `src/components/Layout.tsx`

**OdpowiedzialnoÅ›Ä‡:** GÅ‚Ã³wna struktura UI
**Flow klikniÄ™cia w zakÅ‚adkÄ™:**

1. User klika zakÅ‚adkÄ™ (np. "ğŸ“¥ Import")
2. React Router zmienia URL (`/import`)
3. `<Routes>` w App.tsx renderuje ImportPage
4. Layout pozostaje (header + tabs)

**Struktura:**

```tsx
<div className={styles.layout}>
  <header className={styles.header}>
    <h1>âš½ Bet Assistant 2.0</h1>
  </header>

  <nav className={styles.tabs}>
    {tabs.map((tab) => (
      <Link to={tab.path} className={active ? styles.active : ""}>
        {tab.label}
      </Link>
    ))}
  </nav>

  <main className={styles.main}>
    {children} {/* Tu renderujÄ… siÄ™ strony */}
  </main>
</div>
```

**Tabs konfiguracja:**

```typescript
const tabs = [
  { path: "/import", label: "ğŸ“¥ Import" },
  { path: "/database", label: "ğŸ—„ï¸ Baza Danych" },
  { path: "/bet-finder", label: "ğŸ” Wyszukiwarka TypÃ³w" },
  { path: "/strefa-typera", label: "ğŸ“Š Strefa Typera" },
  { path: "/analytics", label: "ğŸ“ˆ Analityka" },
];
```

#### `src/components/Layout.module.css`

**OdpowiedzialnoÅ›Ä‡:** Style dla Layout
**Kluczowe klasy:**

- `.layout` - Flex container, min-height: 100vh
- `.header` - BiaÅ‚y background, padding, shadow
- `.tabs` - Flex row, gap, biaÅ‚y background
- `.tabButton` - Style zakÅ‚adek
- `.tabButton.active` - Gradient dla aktywnej zakÅ‚adki
- `.main` - GÅ‚Ã³wna zawartoÅ›Ä‡, flex: 1

---

### 2.4 Pages (Strony)

**Status:** Wszystkie strony sÄ… obecnie **placeholderami**

#### `src/pages/ImportPage.tsx`

**Obecny kod:**

```tsx
function ImportPage() {
  return (
    <div style={{ background: "white", padding: "40px", borderRadius: "12px" }}>
      <h2>ğŸ“¥ Import</h2>
      <p>FunkcjonalnoÅ›Ä‡ bÄ™dzie zmigrowana ze starego projektu</p>
    </div>
  );
}
```

**Do implementacji (z `stary/public/js/app.js`):**

- Lista krajÃ³w i lig
- WybÃ³r zakresu dat
- Przycisk "Import"
- Statystyki (liczba lig, meczÃ³w)
- Kolejka importu
- Background jobs display

#### `src/pages/DatabasePage.tsx`

**Do implementacji (z `stary/public/index.html` tab-database):**

- Panel filtrÃ³w (kraj, liga, druÅ¼yna)
- Search z autocomplete
- Tabela wynikÃ³w
- Modal szczegÃ³Å‚Ã³w meczu
- Limity (5, 10, 20, all)

#### `src/pages/BetFinderPage.tsx`

**Do implementacji (z `stary/public/js/bet-finder.js` - 5562 linii!):**

- Kontrolki (TOP wynikÃ³w, limit meczÃ³w, zakres dat)
- 15+ przyciskÃ³w wyszukiwania (grupy: Bramki, RoÅ¼ne, Spalone, etc.)
- SearchQueue panel
- Modal wynikÃ³w (uniwersalny)
- 15+ algorytmÃ³w analitycznych

#### `src/pages/StrefaTyperaPage.tsx`

**Do implementacji:**

- Backfill section
- Actions (accept, verify, create coupon)
- Watched matches modal
- Google Sheets integration

#### `src/pages/AnalyticsPage.tsx`

**Do implementacji (z `stary/public/analytics.html`):**

- Summary cards
- Filtry
- Wykresy (Chart.js?)
- Tabela statystyk
- Export funkcjonalnoÅ›Ä‡

---

### 2.5 API Layer

#### `src/api/client.ts`

**Obecny stan:** Plik istnieje ale jest pusty
**Do implementacji:**

```typescript
// Axios client z konfiguracjÄ…
const apiClient = axios.create({
  baseURL: "/api", // Proxy do localhost:3000
  timeout: 10000,
});

// Funkcje API
export const getLeagues = () => apiClient.get("/leagues");
export const getMatches = (filters) =>
  apiClient.get("/matches", { params: filters });
// ... etc
```

---

### 2.6 State Management

#### `src/store/appStore.ts`

**Obecny stan:** Plik istnieje ale jest pusty
**Do implementacji (Zustand):**

```typescript
interface AppState {
  // Globalne state (np. wybrane ligi, filtry)
  selectedLeagues: number[];
  dateRange: { from: string; to: string };
  // Actions
  setSelectedLeagues: (leagues: number[]) => void;
  setDateRange: (range) => void;
}

export const useAppStore = create<AppState>((set) => ({
  selectedLeagues: [],
  dateRange: { from: "", to: "" },
  setSelectedLeagues: (leagues) => set({ selectedLeagues: leagues }),
  // ...
}));
```

---

### 2.7 Types

#### `src/types/index.ts`

**Obecny stan:** Plik istnieje ale jest pusty
**Do implementacji:**

```typescript
// GÅ‚Ã³wne typy z backendu
export interface League {
  id: number;
  name: string;
  country: string;
  enabled: boolean;
}

export interface Match {
  id: number;
  homeTeam: string;
  awayTeam: string;
  date: string;
  league: League;
  // ... wiÄ™cej pÃ³l
}

export interface BetType {
  id: string;
  name: string;
  description: string;
  algorithm: string;
}

// ... etc
```

---

### 2.8 Styles

#### `src/styles/global.css`

**OdpowiedzialnoÅ›Ä‡:** Globalne style, CSS variables
**Zawiera:**

- CSS Reset (`* { margin: 0; padding: 0; }`)
- CSS Variables (kolory, czcionki)
- Body styles (gradient background)
- Utility classes (loading, spinner)

**CSS Variables:**

```css
:root {
  --primary: #667eea;
  --primary-dark: #5568d3;
  --secondary: #764ba2;
  --success: #48bb78;
  --danger: #f56565;
  --gray-100: #f3f4f6;
  --gray-600: #4b5563;
  --gray-900: #111827;
}
```

---

## 3. FLOW DANYCH

### 3.1 Render Flow (Startup)

```
index.html
  â””â”€> src/main.tsx
       â”œâ”€> QueryClientProvider setup
       â”œâ”€> BrowserRouter setup
       â””â”€> <App />
            â””â”€> <Layout>
                 â”œâ”€> Header
                 â”œâ”€> Navigation Tabs
                 â””â”€> <Routes>
                      â””â”€> Current Page Component
```

### 3.2 Navigation Flow

```
User clicks tab
  â””â”€> React Router <Link>
       â””â”€> URL changes (e.g. /import)
            â””â”€> <Routes> matches path
                 â””â”€> Renders ImportPage
                      â””â”€> Wrapped in Layout (persistent)
```

### 3.3 API Call Flow (do implementacji)

```
Component
  â””â”€> useQuery (TanStack Query)
       â””â”€> api/client.ts function
            â””â”€> Axios request
                 â””â”€> Vite proxy /api â†’ localhost:3000
                      â””â”€> Backend (Express)
                           â””â”€> Response
                                â””â”€> TanStack Query cache
                                     â””â”€> Component re-render
```

---

## 4. KLUCZOWE PLIKI DO MIGRACJI

### 4.1 Z starego projektu (`./stary/`)

**NajwaÅ¼niejsze ÅºrÃ³dÅ‚a:**

1. **`stary/public/js/bet-finder.js`** (5562 linii!)

   - 15+ algorytmÃ³w wyszukiwania
   - Search queue logic
   - Modal configuration
   - **â†’ MigrowaÄ‡ do:** `src/pages/BetFinderPage.tsx` + utils

2. **`stary/public/js/app.js`**

   - Import logic
   - League management
   - **â†’ MigrowaÄ‡ do:** `src/pages/ImportPage.tsx`

3. **`stary/public/js/watched-matches.js`**

   - Watched matches modal
   - **â†’ MigrowaÄ‡ do:** `src/components/WatchedMatches.tsx`

4. **`stary/public/js/search-queue.js`**

   - Search queue panel
   - **â†’ MigrowaÄ‡ do:** `src/hooks/useSearchQueue.ts`

5. **`stary/public/js/config/state.js`**

   - Global state
   - **â†’ MigrowaÄ‡ do:** `src/store/appStore.ts`

6. **`stary/public/js/api/*.js`**

   - API calls
   - **â†’ MigrowaÄ‡ do:** `src/api/client.ts`

7. **`stary/public/js/utils/*.js`**

   - Utility functions
   - **â†’ MigrowaÄ‡ do:** `src/utils/`

8. **`stary/public/css/*.css`**
   - Styles
   - **â†’ MigrowaÄ‡ do:** CSS Modules lub `global.css`

---

## 5. TECHNOLOGIE I BIBLIOTEKI

### 5.1 Core Stack

**React 18.3.1**

- Komponenty funkcyjne
- Hooks (useState, useEffect, custom hooks)
- JSX/TSX syntax

**TypeScript 5.9.3**

- Strict mode enabled
- Type safety dla wszystkich komponentÃ³w
- Interfaces dla danych z API

**Vite 5.4.21**

- Dev server (HMR - Hot Module Replacement)
- Build tool (Rollup pod spodem)
- Proxy `/api` â†’ `localhost:3000`

### 5.2 Routing & State

**React Router 6.30.2**

- `<BrowserRouter>` - client-side routing
- `<Routes>` + `<Route>` - Å›cieÅ¼ki
- `<Link>` - nawigacja
- `useLocation()` - aktywna zakÅ‚adka

**Zustand 5.0.9**

- Lightweight state management
- Prostsza alternatywa dla Redux
- `create()` - tworzenie store
- Hooks: `useAppStore()`

**TanStack Query 5.90.15**

- Server state management
- Auto caching
- Auto refetching
- `useQuery()` - fetch data
- `useMutation()` - POST/PUT/DELETE

### 5.3 Styling

**CSS Modules**

- Scoped CSS dla komponentÃ³w
- `import styles from './Component.module.css'`
- `className={styles.button}`

**Global CSS**

- CSS Variables (`--primary`, etc.)
- Reset styles
- Typography

---

## 6. BACKEND API I WORKER

**Lokalizacja:** `server/` (skopiowany ze `stary/`)
**Base URL:** `http://localhost:3000`
**Proxy:** Vite przekierowuje `/api/*` â†’ `localhost:3000`
**Status:** âœ… NiezaleÅ¼ny od folderu `stary/`

### 6.1 Architektura Backend

Backend skÅ‚ada siÄ™ z **3 procesÃ³w**:

1. **Express Server** (`league-config-server.ts`) - HTTP API
2. **Import Worker** (`background-import-worker.ts`) - Przetwarzanie zadaÅ„ importu w tle
3. **PostgreSQL Database** (Prisma)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (React)  â”‚
â”‚  localhost:5173     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ /api/* requests
           â”‚ (proxied by Vite)
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Express Server     â”‚â—„â”€â”€â”€â”€â”€â”€â”¤  Import Worker       â”‚
â”‚  localhost:3000     â”‚       â”‚  (Background)        â”‚
â”‚  (API endpoints)    â”‚       â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â”‚  Prisma ORM                 â”‚  Prisma ORM
           â”‚                             â”‚
           â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL Database                      â”‚
â”‚  (import_jobs, matches, leagues, ...)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘
           â”‚ API calls
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API-Football.com   â”‚
â”‚  (External API)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Import Worker - Jak dziaÅ‚a?

**Plik:** `server/background-import-worker.ts` (588 linii)
**OdpowiedzialnoÅ›Ä‡:** Przetwarzanie zadaÅ„ importu w tle

#### Lifecycle:

1. **Start:** Worker startuje i od razu sprawdza zadania
2. **Check Loop:** Co 5 minut sprawdza bazÄ™ w poszukiwaniu zadaÅ„ do przetworzenia
3. **Job Processing:** Przetwarza **jedno zadanie na raz** (lock: `processingJobId`)
4. **Auto Resume:** Po zakoÅ„czeniu zadania natychmiast sprawdza kolejne (nie czeka 5 minut)

#### Priorytety zadaÅ„:

```sql
-- Worker wybiera zadania w kolejnoÅ›ci:
1. rate_limited jobs (rate_limit_reset_at < NOW()) -- NajwyÅ¼szy priorytet
2. pending jobs (jeÅ›li brak running/rate_limited)  -- NiÅ¼szy priorytet
```

#### Flow przetwarzania:

```
Worker.checkAndProcessJobs()
  â”‚
  â”œâ”€> SprawdÅº lock (processingJobId)
  â”‚   â””â”€> JeÅ›li zajÄ™ty â†’ skip
  â”‚
  â”œâ”€> Query SQL: znajdÅº zadanie do przetworzenia
  â”‚   â””â”€> rate_limited (ready) OR pending (if no active jobs)
  â”‚
  â”œâ”€> Ustaw lock (processingJobId = job.id)
  â”‚
  â”œâ”€> processJob(job)
  â”‚   â”‚
  â”‚   â”œâ”€> Dla kaÅ¼dej ligi:
  â”‚   â”‚   â”‚
  â”‚   â”‚   â”œâ”€> Dla kaÅ¼dej daty w zakresie:
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â”œâ”€> ApiFootballClient.getFixtures()
  â”‚   â”‚   â”‚   â”‚   â””â”€> GET api-football.com/v3/fixtures
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â”œâ”€> Rate limit check
  â”‚   â”‚   â”‚   â”‚   â””â”€> JeÅ›li 429 â†’ status='rate_limited', rate_limit_reset_at = +1h
  â”‚   â”‚   â”‚   â”‚
  â”‚   â”‚   â”‚   â””â”€> DataImporter.processFixtures()
  â”‚   â”‚   â”‚       â””â”€> INSERT/UPDATE matches w PostgreSQL
  â”‚   â”‚   â”‚
  â”‚   â”‚   â””â”€> Oznacz ligÄ™ jako completed
  â”‚   â”‚
  â”‚   â”œâ”€> Status update: 'completed' lub 'failed'
  â”‚   â”‚
  â”‚   â””â”€> DatabaseBackup.autoBackup() (jeÅ›li job_type = new_matches)
  â”‚
  â”œâ”€> Zwolnij lock (processingJobId = null)
  â”‚
  â””â”€> setImmediate(() => checkAndProcessJobs())  // SprawdÅº kolejne zadanie NATYCHMIAST
```

#### Rate Limiting:

Worker obsÅ‚uguje limity API:

- **API-Football limit:** 100 requestÃ³w / dzieÅ„ (darmowy plan)
- **Rate limit detection:** HTTP 429 response
- **Auto resume:** Worker zapisuje `rate_limit_reset_at = NOW() + 1 hour`
- **Next check:** Worker sprawdza co 5 minut czy `rate_limit_reset_at < NOW()`
- **Resume:** Automatycznie wznawia zadanie po upÅ‚ywie czasu

#### Logging:

- **Console:** Real-time logs w terminalu
- **File:** `logs/import-YYYY-MM-DD.log`
- **Email:** Powiadomienia o zakoÅ„czeniu/bÅ‚Ä™dzie (jeÅ›li SMTP skonfigurowane)

#### PrzykÅ‚adowe logi:

```
ğŸš€ Background Import Worker started
ğŸ“ Logs directory: D:\narzÄ™dzia\Bet Assistant 2.0\logs
â° Checking for jobs every 5 minutes...

ğŸ” Checking for pending jobs...
âœ… Found job #12 to process
ğŸ“ Processing job #12 (new_matches)
  ğŸ† League: Premier League (39)
    ğŸ“… 2025-01-01: 5 fixtures imported
    ğŸ“… 2025-01-02: 3 fixtures imported
  âœ… League completed (39)
  ğŸ† League: La Liga (140)
    ğŸ“… 2025-01-01: 4 fixtures imported
    â¸ï¸  Rate limit hit! Reset at: 2025-12-30 17:00:00
ğŸ’¾ Job #12 paused (rate_limited)
ğŸ” Job finished, checking for next job in queue...
ğŸ’¤ No jobs to process
```

#### Uruchomienie:

```bash
# Osobno (terminal)
npm run server:worker

# Razem z backendem i frontendem
start-all.bat  # Uruchamia wszystkie 3 procesy

# Tylko worker
scripts\start-worker.bat
```

### 6.3 Struktura API:

**Import Jobs:**

- `GET /api/import-jobs` - lista zadaÅ„ importu
  - Query params: `showHidden=true/false`
  - Response: `ImportJob[]`
- `POST /api/import-jobs` - utwÃ³rz nowe zadanie
  - Body: `{ leagueIds: number[], dateFrom: string, dateTo: string, jobType: 'new_matches' | 'update_results' }`
  - Response: `{ success: true, jobId: number }`
- `DELETE /api/import-jobs/:id` - usuÅ„ zadanie
- `POST /api/import-jobs/:id/retry` - ponÃ³w prÃ³bÄ™ zadania
- `POST /api/import-jobs/:id/clone` - sklonuj zadanie

**Import Job Schema:**

```typescript
interface ImportJob {
  id: number;
  leagues: number[]; // Array league IDs
  date_from: string; // YYYY-MM-DD
  date_to: string; // YYYY-MM-DD
  job_type: "new_matches" | "update_results";
  status:
    | "in_queue"
    | "pending"
    | "running"
    | "paused"
    | "completed"
    | "failed"
    | "rate_limited";
  progress: {
    current_league?: number;
    current_date?: string;
    completed_leagues?: number[]; // Array completed league IDs
  };
  total_matches: number;
  imported_matches: number;
  failed_matches: number;
  rate_limit_remaining: number;
  rate_limit_reset_at: string | null; // ISO timestamp
  error_message?: string;
  created_at: string; // ISO timestamp
  started_at?: string;
}
```

**Config:**

- `GET /api/config` - konfiguracja aplikacji
  - Response: `{ leagues: League[], conditions: BetCondition[] }`

### 6.4 Services (Backend Logic)

#### `server/src/services/api-football-client.ts`

**OdpowiedzialnoÅ›Ä‡:** Komunikacja z API-Football.com
**Kluczowe metody:**

- `getFixtures(date, leagueId, season)` - pobiera mecze
- `getFixtureStatistics(fixtureId)` - pobiera statystyki meczu
- `getFixtureEvents(fixtureId)` - pobiera wydarzenia (bramki, kartki)
- `getH2H(team1, team2)` - head-to-head statystyki

**Rate limiting:**

- Limit: 100 requestÃ³w/dzieÅ„ (darmowy plan)
- Detection: HTTP 429 response
- Handling: Worker pausuje zadanie na 1 godzinÄ™

#### `server/src/services/data-importer.ts`

**OdpowiedzialnoÅ›Ä‡:** Przetwarzanie i zapis danych do bazy
**Flow:**

1. Odbiera fixtures z API-Football
2. Transformuje dane (mapping)
3. INSERT/UPDATE w PostgreSQL (przez Prisma)
4. Zwraca statystyki (imported, failed)

#### `server/src/services/league-selector.ts`

**OdpowiedzialnoÅ›Ä‡:** ZarzÄ…dzanie ligami
**Funkcje:**

- `getEnabledLeagues()` - pobiera aktywne ligi
- `enableLeague(leagueId)` - wÅ‚Ä…cza ligÄ™
- `disableLeague(leagueId)` - wyÅ‚Ä…cza ligÄ™

### 6.5 Tech Stack (backend):

- **Express 5.1.0** - serwer HTTP
- **Prisma 6.18.0** - ORM
- **PostgreSQL** - baza danych
- **Node.js 24.11.1** - runtime
- **tsx** - TypeScript execution
- **nodemon** - auto-reload podczas development
- **dotenv** - zmienne Å›rodowiskowe
- **googleapis** - Google Sheets integration
- **nodemailer** - email notifications

### 6.6 Pliki konfiguracyjne:

- `.env` - zmienne Å›rodowiskowe
  ```env
  DATABASE_URL="postgresql://..."
  API_FOOTBALL_KEY="your_key"
  SMTP_HOST="smtp.gmail.com"
  SMTP_USER="your_email"
  SMTP_PASS="your_password"
  ```
- `config/google-sheets-config.json` - konfiguracja Google Sheets API
- `config/bet-conditions.json` - warunki zakÅ‚adÃ³w
- `prisma/schema.prisma` - schema bazy danych

### 6.7 Scripts npm (Backend):

```json
{
  "server": "nodemon --exec npx tsx server/league-config-server.ts",
  "server:worker": "npx tsx server/background-import-worker.ts",
  "db:generate": "prisma generate",
  "db:studio": "prisma studio",
  "db:migrate": "prisma migrate dev"
}
```

---

## 7. LAUNCHERS (Uruchomienie)

### 7.1 start-all.bat (Recommended)

**Lokalizacja:** Root projektu
**Uruchamia:** Backend Server + Import Worker + Frontend (Vite)

```bash
start-all.bat
```

**Flow:**

1. Sprawdza czy backend juÅ¼ dziaÅ‚a (localhost:3000)
2. JeÅ›li nie â†’ Uruchamia backend w nowym oknie terminala
3. Uruchamia worker w osobnym oknie terminala
4. Czeka 2 sekundy
5. Uruchamia frontend (Vite) w bieÅ¼Ä…cym oknie
6. Po 3 sekundach otwiera przeglÄ…darkÄ™ (localhost:5173)

**Rezultat:** 3 okna terminala:

- **Backend Server** - Express API (localhost:3000)
- **Import Worker** - Background jobs processor
- **Frontend** - Vite dev server (localhost:5173)

### 7.2 scripts\start.bat (Frontend only)

**Lokalizacja:** `scripts/start.bat`
**Uruchamia:** Tylko frontend (Vite)

```bash
scripts\start.bat
```

**UÅ¼ycie:** Gdy backend i worker juÅ¼ dziaÅ‚ajÄ… osobno

### 7.3 scripts\start-worker.bat (Worker only)

**Lokalizacja:** `scripts/start-worker.bat`
**Uruchamia:** Tylko import worker

```bash
scripts\start-worker.bat
```

**UÅ¼ycie:** Gdy chcesz uruchomiÄ‡ tylko worker (np. na serwerze produkcyjnym)

### 7.4 RÄ™czne uruchomienie (Development)

```bash
# Terminal 1: Backend Server
npm run server

# Terminal 2: Import Worker
npm run server:worker

# Terminal 3: Frontend
npm run dev
```

---

## 8. DEVELOPMENT WORKFLOW

### 8.1 Uruchomienie projektu (Development)

**Opcja 1: Wszystko naraz (Recommended)**

```bash
cd "D:\narzÄ™dzia\Bet Assistant 2.0"
start-all.bat
```

**Rezultat:**

- Backend API: `http://localhost:3000`
- Import Worker: Background process
- Frontend: `http://localhost:5173` (auto-open w przeglÄ…darce)

**Opcja 2: RÄ™cznie (3 terminale)**

```bash
# Terminal 1: Backend
npm run server

# Terminal 2: Worker
npm run server:worker

# Terminal 3: Frontend
npm run dev
```

### 8.2 Build produkcyjny

```bash
npm run build
```

**Rezultat:** Pliki w folderze `/dist`

### 8.3 Preview buildu

```bash
npm run preview
```

### 8.4 TypeScript check

```bash
npx tsc --noEmit
```

### 8.5 Praca z bazÄ… danych

**Prisma Studio (GUI):**

```bash
npm run db:studio
```

**Migracje:**

```bash
npm run db:migrate
```

**Regeneracja Prisma Client:**

```bash
npm run db:generate
```

---

## 9. GIT & GITHUB

**Repository:** https://github.com/Norfeusz/bet-assisstant-2.0.git  
**Branch:** main

### Struktura commitÃ³w:

```
feat: dodaj nowÄ… funkcjonalnoÅ›Ä‡
fix: napraw bug
refactor: refaktoryzacja
docs: aktualizacja dokumentacji
style: formatowanie
```

---

## 10. PLAN IMPLEMENTACJI (Etapy)

**Status:** âœ… Etap 0 - Setup (ukoÅ„czony), â³ Krok 2 - Import Page (w trakcie)

### âœ… Krok 1: Launcher (UKOÅƒCZONY)

- âœ… `start-all.bat` - uruchamia backend + worker + frontend
- âœ… `scripts/start.bat` - uruchamia tylko frontend
- âœ… `scripts/start-worker.bat` - uruchamia tylko worker
- âœ… Backend zmigrowany do `server/`
- âœ… Prisma schema i migracje skopiowane
- âœ… Wszystkie pliki konfiguracyjne (.env, config/)

### â³ Krok 2: Import Page (W TRAKCIE)

- âœ… `src/pages/ImportPage.tsx` - komponent React z peÅ‚nÄ… funkcjonalnoÅ›ciÄ…
- âœ… `src/pages/ImportPage.module.css` - stylowanie CSS Modules
- âœ… Funkcje:
  - Modal do tworzenia zadania (wybÃ³r lig, zakres dat, typ zadania)
  - Lista zadaÅ„ z auto-refresh (co 5s)
  - Statusy zadaÅ„ z kolorami
  - Paski postÄ™pu dla aktywnych zadaÅ„
  - Toggle ukrytych/aktywnych zadaÅ„
  - ObsÅ‚uga bÅ‚Ä™dÃ³w i rate limitÃ³w
  - **URL params dla automatycznego otwierania modala** (cross-page navigation)
- âœ… **Krok 3: ObsÅ‚uga aktywnego zadania**
  - Przyciski akcji: Wstrzymaj, WznÃ³w, ZakoÅ„cz
  - Integracja z API: `/api/import-jobs/:id/pause`, `/resume`, `/delete`
  - Walidacja statusÃ³w (pokazuj odpowiednie przyciski dla kaÅ¼dego statusu)
- âœ… **Krok 4: Masowe operacje i ukrywanie**
  - Checkbox przy kaÅ¼dym zadaniu + "Zaznacz wszystkie"
  - Przycisk "UsuÅ„" dla zadaÅ„ w kolejce (in_queue, pending)
  - Przycisk "Ukryj" dla zadaÅ„ zakoÅ„czonych (completed, failed)
  - Akcje masowe: "UsuÅ„ zaznaczone", "Ukryj zaznaczone"
  - Funkcje: `hideJob()`, `deleteJob()`, `toggleJobSelection()`, `toggleSelectAll()`
- âœ… **Krok 5: Przyciski szybkiego wyboru dat**
  - Funkcja `setDatePreset()` z 8 presetami
  - Dni: przedwczoraj, wczoraj, dzisiaj, jutro, pojutrze
  - Tygodnie: poprzedni, obecny, nastÄ™pny (poniedziaÅ‚ek-niedziela)
  - UI: grid 5 kolumn, przyciski tygodniowe szersze (span 2)
  - Style: btnPreset (szary), btnPresetWide (niebieski)
- ğŸ”² Testy funkcjonalnoÅ›ci (do wykonania po uruchomieniu)

### ğŸ“‹ NastÄ™pne kroki (z Migracja.txt):

- Krok 3: ZakÅ‚adka - Baza Danych
- Krok 4: ZakÅ‚adka - Wyszukiwarka TypÃ³w (Bet Finder)
- Krok 5: ZakÅ‚adka - Strefa Typera
- Krok 6: ZakÅ‚adka - Analityka
- Krok 7-10: Infrastruktura, komponenty wspÃ³Å‚dzielone, polish

---

## 11. AKTUALIZACJE

**30 grudnia 2025 - 15:56:**

- âœ… Inicjalizacja projektu (Vite + React + TypeScript)
- âœ… Setup routing (5 stron z placeholderami)
- âœ… Layout z nawigacjÄ…
- âœ… Git + GitHub integration
- âœ… Dokumentacja (3 pliki)

**30 grudnia 2025 - 16:30:**

- âœ… **Launcher** - start.bat i start-all.bat
- âœ… **Backend skopiowany** ze `stary/` do `server/`
- âœ… **Prisma** - schema i migracje skopiowane
- âœ… **Config** - .env i config/ skopiowane
- âœ… **Dependencies** - backend packages zainstalowane
- âœ… **Backend dziaÅ‚a** niezaleÅ¼nie na localhost:3000

**30 grudnia 2025 - 17:45:**

- âœ… **Import Worker** - zintegrowany z start-all.bat
- âœ… **ImportPage.tsx** - peÅ‚na implementacja React
- âœ… **Dokumentacja** - rozbudowana o worker i import flow
- âœ… **scripts/start-worker.bat** - osobny launcher dla workera

**30 grudnia 2025 - 18:30:**

- âœ… **Bugfix: Worker** - naprawiono import path `../db.js` â†’ `../db/index.js`
- âœ… **Bugfix: Worker** - zamieniono `require.main` na ES module check w backup-database.ts
- âœ… **Bugfix: Worker** - naprawiono formatowanie w metodzie `start()` (setInterval)
- âœ… **Krok 3: ObsÅ‚uga aktywnego zadania**
  - Dodano funkcje: `pauseJob()`, `resumeJob()`, `cancelJob()`
  - Dodano przyciski akcji w kartach zadaÅ„
  - Style dla przyciskÃ³w (btnAction, btnActionDanger)
  - Warunkowe wyÅ›wietlanie przyciskÃ³w wedÅ‚ug statusu zadania

**30 grudnia 2025 - 19:00:**

- âœ… **Krok 4: Masowe operacje i ukrywanie zadaÅ„**
  - Stan `selectedJobs` dla zaznaczonych zadaÅ„
  - Toolbar z checkboxem "Zaznacz wszystkie" i licznikiem
  - Funkcje: `hideJob()`, `deleteJob()`, `hideSelectedJobs()`, `deleteSelectedJobs()`
  - UI: checkbox przy kaÅ¼dym zadaniu, przyciski masowe w toolbar
  - Przyciski indywidualne: "UsuÅ„" (kolejka), "Ukryj" (zakoÅ„czone)
  - Style: toolbar, selectAllLabel, btnBulkDelete, btnBulkHide, jobCheckbox

**30 grudnia 2025 - 19:15:**

- âœ… **Krok 5: Przyciski szybkiego wyboru dat**
  - Funkcja `setDatePreset()` - obsÅ‚uga 8 presetÃ³w
  - Presety dni: przedwczoraj, wczoraj, dzisiaj, jutro, pojutrze
  - Presety tygodni: poprzedni, obecny, nastÄ™pny (poniedziaÅ‚ek-niedziela)
  - Logika kalkulacji dat z uwzglÄ™dnieniem poniedziaÅ‚ku jako pierwszego dnia tygodnia
  - UI: grid layout 5 kolumn, przyciski dzienne (1 kolumna), tygodniowe (2 kolumny)
  - Style: btnPreset (szary), btnPresetWide (niebieski z ikonami)

**30 grudnia 2025 - 20:00:**

- âœ… **Krok 6: Kalendarz z informacjÄ… o zaimportowanych meczach**
  - Dodano funkcjÄ™ `renderCalendar()` z nawigacjÄ… miesiÄ…c w miesiÄ…c
  - Click-to-select: klikniÄ™cie dnia wypeÅ‚nia dateFrom/dateTo
  - Color coding: biaÅ‚e (brak), niebieskie (new_matches), zielone (update_results)
  - Modal z kalendarzem i legendÄ… kolorÃ³w
  - Analiza wszystkich zadaÅ„ (visible + hidden) dla dokÅ‚adnoÅ›ci
  - Funkcja `formatLocalDate()` - unika problemÃ³w z UTC timezone

**31 grudnia 2025 - 12:00:**

- âœ… **Krok 7-8: Wyszukiwarka TypÃ³w - Struktura i UI**
  - Utworzono `BetFinderPage.tsx` (420 linii) - peÅ‚na struktura React
  - Utworzono `BetFinderPage.module.css` (450 linii) - kompletny styling
  - **Krok 7 - Zaimplementowane elementy:**
    - Liczba najlepszych wynikÃ³w (TOP 5/10/15/20)
    - Liczba meczÃ³w do analizy (5/10/15/20/30/50/Wszystkie)
    - Zakres dat nadchodzÄ…cych meczÃ³w (date picker + 3 presety)
    - Button "Automatycznie dodaj typy" (otwiera modal)
    - Kolejka wyszukiwaÅ„ (struktura UI, pusta na start)
  - **Krok 8 - Modal z typami (z zachowaniem grupowania):**
    - **Grupa 1: Rezultat** - Wygrane vs Przegrane
    - **Grupa 2: Bramki** - 6 typÃ³w (NajwiÄ™cej bramek, Najmniej bramek, Przewaga bramkowa, Handicap 1.5, NajwiÄ™cej BTS, Bez BTS)
    - **Grupa 3: RoÅ¼ne** - 4 typy (WYKLUCZONO: najwiÄ™cej/najmniej roÅ¼nych pojedynczo)
    - **Grupa 4: Dom/Wyjazd** - 4 typy (Przewaga gospodarzy, Przewaga goÅ›ci, Bramki gospodarzy, Bramki goÅ›ci)
  - Stan aplikacji: topCount, matchCount, dateFrom, dateTo, searchQueue, selectedBetTypes
  - Funkcje pomocnicze: formatDate(), setTodayDate(), setTomorrowDate(), setDayAfterTomorrowDate()
  - UI: Checkboxy w modalu, licznik wybranych typÃ³w, przycisk "Dodaj do kolejki"
  - **TODO dla nowego agenta:** Implementacja logiki wyszukiwania i kolejki (backend + algorytmy)

**NastÄ™pny krok:** Przekazanie projektu do nowego agenta dla implementacji logiki wyszukiwania

**31 grudnia 2025 - 17:00:**

- âœ… **Bet Finder - Backend Implementation (Algorytm: Winner vs Loser)**
  - **Utworzono:** `server/src/services/bet-finder-algorithms.ts` (305 linii)
    - Algorytm `searchWinnerVsLoser()` - wyszukuje mecze gdzie gospodarz czÄ™sto wygrywa, goÅ›Ä‡ czÄ™sto przegrywa
    - Funkcje pomocnicze: `getUpcomingMatches()`, `getTeamHistory()`, `calculateTeamStats()`
    - Router `searchByType()` dla rÃ³Å¼nych algorytmÃ³w (16 typÃ³w - wiÄ™kszoÅ›Ä‡ TODO)
  - **Utworzono:** `server/src/services/bet-finder-service.ts` (107 linii)
    - ZarzÄ…dzanie kolejkÄ… wyszukiwaÅ„ (in-memory storage)
    - Funkcje: `createSearchJob()`, `processJob()`, `getAllSearchJobs()`, `getSearchJob()`, `deleteSearchJob()`, `clearCompletedJobs()`
    - Auto-processing zadaÅ„ w tle
  - **Utworzono:** `server/routes/bet-finder.ts` (150 linii)
    - API endpoints:
      - `POST /api/bet-finder/search` - tworzy wyszukiwania dla wielu typÃ³w
      - `GET /api/bet-finder/queue` - pobiera kolejkÄ™
      - `GET /api/bet-finder/queue/:id` - szczegÃ³Å‚y zadania
      - `DELETE /api/bet-finder/queue/:id` - usuwa zadanie
      - `POST /api/bet-finder/queue/clear` - czyÅ›ci ukoÅ„czone
  - **Zmodyfikowano:** `server/league-config-server.ts`
    - Dodano import i routing dla `betFinderRouter`
- âœ… **Bet Finder - Frontend Integration**
  - **Zmodyfikowano:** `src/pages/BetFinderPage.tsx`
    - Funkcja `loadSearchQueue()` - pobiera kolejkÄ™ z API
    - Funkcja `addToQueue()` - wysyÅ‚a wyszukiwania do backendu (POST /api/bet-finder/search)
    - Auto-refresh co 5 sekund (useEffect + setInterval)
    - TÅ‚umaczenie typÃ³w i statusÃ³w na polski (`translateSearchType()`, `translateStatus()`)
    - WyÅ›wietlanie liczby wynikÃ³w dla ukoÅ„czonych zadaÅ„
    - WyÅ›wietlanie komunikatÃ³w bÅ‚Ä™dÃ³w
  - **Zmodyfikowano:** `src/pages/BetFinderPage.module.css`
    - Dodano style: `.resultsCount`, `.errorMessage`
- âœ… **Dokumentacja**
  - Utworzono: `Dokumentacja/Bet Finder - Winner vs Loser - Implementacja.md` (peÅ‚ny opis algorytmu, API, flow)
- âœ… **Testowanie**
  - Backend dziaÅ‚a na localhost:3000
  - Frontend dziaÅ‚a na localhost:5174
  - Integracja dziaÅ‚a end-to-end

**NastÄ™pny krok:** Implementacja pozostaÅ‚ych 15 algorytmÃ³w wyszukiwania

**14 lutego 2026 - 16:30:**

- âœ… **Database Browser - Universal PostgreSQL Interface**
  - **Utworzono:** `server/src/services/database-browser.ts` (369 linii)
    - Klasa `DatabaseBrowserService` z dynamic connection pooling
    - Metody:
      - `listDatabases()` - lista wszystkich baz w PostgreSQL
      - `listTables(db)` - lista tabel z liczbÄ… wierszy i rozmiarem
      - `getTableSchema(db, table)` - schemat kolumn, PK, FK
      - `queryTableData(db, table, options)` - zapytania z filtrami, sortowaniem, paginacjÄ…
    - Multi-database support (dynamiczne poÅ‚Ä…czenia poza Prisma)
    - Multi-column sorting (ORDER BY col1, col2, col3...)
    - Walidacja i error handling
  - **Utworzono:** `server/routes/database.ts` (109 linii)
    - API endpoints:
      - `GET /api/database/list` - lista baz danych + defaultDatabase
      - `GET /api/database/:db/tables` - lista tabel w bazie
      - `GET /api/database/:db/tables/:table/schema` - schemat tabeli
      - `POST /api/database/:db/tables/:table/query` - zapytanie z filtrami
    - Detailed logging dla debugowania
  - **Zmodyfikowano:** `server/league-config-server.ts`
    - Dodano import i routing dla `databaseRouter`
  - **Zmodyfikowano:** `package.json`
    - Dodano: `pg: ^8.13.1`, `@types/pg: ^8.11.10`
- âœ… **Database Browser - Frontend (React + CSS Modules)**
  - **Utworzono:** `src/pages/DatabasePage.tsx` (792 linie)
    - FunkcjonalnoÅ›ci:
      - **Multi-database selector** - wybÃ³r bazy danych z listy
      - **Table browser** - lista tabel z liczbÄ… wierszy i rozmiarem
      - **Dynamic schema** - automatyczne wykrywanie kolumn, typÃ³w, PK, FK
      - **Intelligent sorting** - Excel-like (Click: single sort, Shift+Click: multi-sort)
      - **Column reordering** - is_finished na pozycji 4 dla tabeli matches
      - **Smart filtering** - dynamiczne operatory wedÅ‚ug typu kolumny
      - **Global search** - przeszukiwanie wszystkich kolumn tekstowych
      - **Pagination** - 100/500 rekordÃ³w na stronÄ™
      - **Type-aware rendering** - formatowanie dat, boolean, JSON, liczb
      - **Visual indicators** - ikony dla PK (ğŸ”‘), FK (ğŸ”—), typÃ³w danych
      - **Debounced input** - 1s delay dla search/filters (UX optimization)
      - **Focus preservation** - input pozostaje aktywny po reload
      - **Conditional styling** - is_finished: yes=zielony, no=niebieski
    - State management: 15+ useState hooks
    - Custom helpers:
      - `getDefaultSortColumn()` - inteligentny wybÃ³r kolumny (date â†’ PK â†’ first)
      - `renderCellValue()` - formatowanie wartoÅ›ci wedÅ‚ug typu
      - `getColumnTypeIcon()` - ikony dla typÃ³w kolumn
      - `getCellClassName()` - warunkowe CSS classes
      - `reorderColumns()` - przesuniÄ™cie kolumn dla matches table
    - Debouncing pattern: searchTerm â†’ 1000ms â†’ debouncedSearchTerm â†’ API
  - **Utworzono:** `src/pages/DatabasePage.module.css` (545 linii)
    - Gradient header design (purple-blue)
    - Fixed horizontal headers (writing-mode fix)
    - Sticky horizontal scroll (position: sticky, bottom: 0)
    - Max-height table wrapper (calc(100vh - 350px))
    - Primary key cells (gold background)
    - Foreign key cells (blue background)
    - Conditional styles:
      - `.finishedYes` - zielone tÅ‚o dla is_finished=yes
      - `.finishedNo` - niebieskie tÅ‚o dla is_finished=no
    - Sort indicators (strzaÅ‚ki + numerki w kÃ³Å‚kach)
    - Loading overlay z blur backdrop
    - Responsive design (mobile breakpoints)
- âœ… **Database Browser - UX Features**
  - **Excel-like sorting:**
    - Click: sortuj tylko po tej kolumnie (reset poprzedniego)
    - Shift+Click: dodaj kolumnÄ™ do multi-sort
    - Toggle ASC/DESC przy ponownym klikniÄ™ciu
    - Wizualizacja: â†‘â†“ + numerki â‘  â‘¡ â‘¢
  - **Search optimization:**
    - 1000ms debounce delay (zmniejsza liczbÄ™ API calls)
    - Focus preservation (kursor pozostaje w input po reload)
    - Auto-clear przy zmianie tabeli/bazy
  - **Smart defaults:**
    - Auto-load 100 najnowszych rekordÃ³w po wyborze tabeli
    - DomyÅ›lne sortowanie: data â†’ PK â†’ first column (DESC)
  - **Tooltips:**
    - Typ kolumny, nullable, default, FK references
    - "Click: sort | Shift+Click: add to multi-sort"
- âœ… **Testing & Debugging**
  - Backend: SQL query logging (ğŸ” Generated SQL Query)
  - Frontend: Error handling + error banner
  - Multi-database queries verified (bet_assistant, postgres, template1)
  - Multi-column sorting tested (country â†’ league â†’ date)
  - Rate limit handling: 1s debounce eliminuje excessive requests

**Flow - User klika w kolumnÄ™ (sortowanie):**

```
User Click Event
  â”‚
  â”œâ”€> handleSort(columnName, event)
  â”‚   â”‚
  â”‚   â”œâ”€> event.shiftKey?
  â”‚   â”‚   â”‚
  â”‚   â”‚   YES â†’ Multi-sort mode
  â”‚   â”‚   â”‚   â”œâ”€> Column exists? â†’ Toggle direction
  â”‚   â”‚   â”‚   â””â”€> Column new? â†’ Add to sortColumns[]
  â”‚   â”‚   â”‚
  â”‚   â”‚   NO â†’ Single-sort mode
  â”‚   â”‚       â”œâ”€> Same column? â†’ Toggle direction
  â”‚   â”‚       â””â”€> Different? â†’ Reset to new column
  â”‚   â”‚
  â”‚   â””â”€> setSortColumns([...]) + setCurrentPage(1)
  â”‚
  â”œâ”€> useEffect [sortColumnsKey]
  â”‚   â””â”€> loadTableData()
  â”‚       â”‚
  â”‚       â”œâ”€> Save activeElement (focus preservation)
  â”‚       â”œâ”€> POST /api/database/:db/tables/:table/query
  â”‚       â”‚   Body: { sortColumns: [{column, direction}, ...], filters, search, page }
  â”‚       â”‚
  â”‚       â””â”€> Backend: DatabaseBrowserService.queryTableData()
  â”‚           â”‚
  â”‚           â”œâ”€> Build ORDER BY clause
  â”‚           â”‚   ORDER BY "col1" ASC, "col2" DESC, "col3" ASC
  â”‚           â”‚
  â”‚           â”œâ”€> Execute SQL query
  â”‚           â”‚
  â”‚           â””â”€> Return: { rows, totalCount, page, totalPages }
  â”‚
  â””â”€> UI Update
      â”œâ”€> Render rows with reordered columns
      â”œâ”€> Show sort indicators (â†‘â†“ + â‘  â‘¡ â‘¢)
      â””â”€> Restore focus to activeElement
```

**API Endpoints Table:**

| Method | Endpoint | Description | Response |
|--------|---------|-------------|----------|
| GET | `/api/database/list` | Lista wszystkich baz danych | `{ databases: DatabaseInfo[], defaultDatabase: string }` |
| GET | `/api/database/:db/tables` | Lista tabel w bazie | `{ tables: TableInfo[] }` |
| GET | `/api/database/:db/tables/:table/schema` | Schemat kolumn tabeli | `TableSchema` (columns, primaryKeys, foreignKeys) |
| POST | `/api/database/:db/tables/:table/query` | Zapytanie z filtrami i sortowaniem | `QueryResult` (rows, totalCount, page, totalPages) |

**TypeScript Interfaces:**

```typescript
interface DatabaseInfo {
  name: string
  size?: string
  tables?: number
}

interface TableInfo {
  name: string
  schema: string
  rows?: number
  size?: string
}

interface ColumnInfo {
  name: string
  type: string
  nullable: boolean
  default: string | null
  isPrimaryKey: boolean
  isForeignKey: boolean
  foreignKeyTable?: string
  foreignKeyColumn?: string
}

interface QueryResult {
  rows: any[]
  totalCount: number
  page: number
  pageSize: number
  totalPages: number
}
```

**14 lutego 2026 - 18:00:**

- âœ… **Database Browser - CRUD Operations (Etap 2)**
  - **Zaktualizowano:** `server/src/services/database-browser.ts` (464 linie)
    - Nowe metody:
      - `insertRecord(db, table, schema, data)` - INSERT INTO z RETURNING *
        - Parametryzowane zapytania ($1, $2, $3...)
        - Automatyczne kolumny i placeholders
        - Zwraca wstawiony rekord
      - `updateRecord(db, table, schema, primaryKey, data)` - UPDATE SET WHERE
        - Walidacja primary key
        - SET clause z parametrami
        - Zwraca zaktualizowany rekord (RETURNING *)
      - `deleteRecords(db, table, schema, primaryKey)` - DELETE WHERE IN (bulk)
        - Wspiera usuwanie wielu rekordÃ³w naraz
        - Zwraca rowCount (liczba usuniÄ™tych)
    - Logging dla kaÅ¼dej operacji (ğŸ“ Insert, âœï¸ Update, ğŸ—‘ï¸ Delete)
  - **Zaktualizowano:** `server/routes/database.ts` (189 linii)
    - Nowe endpointy:
      - `POST /api/database/:db/tables/:table/insert` - dodawanie rekordu
      - `PUT /api/database/:db/tables/:table/update` - edycja rekordu
      - `DELETE /api/database/:db/tables/:table/delete` - usuwanie rekordÃ³w
    - Walidacja danych wejÅ›ciowych (400 Bad Request)
    - Error handling z szczegÃ³Å‚owymi komunikatami
  - **Zaktualizowano:** `src/pages/DatabasePage.tsx` (1236 linii)
    - Nowy state:
      - `selectedRows: Set<any>` - zaznaczone rekordy (checkboxy)
      - `showInsertModal`, `showUpdateModal`, `showDeleteModal`
      - `editingRow` - rekord do edycji
      - `crudLoading` - loading state dla operacji CRUD
    - Nowe handlery:
      - `handleToggleRow(row)` - zaznacz/odznacz rekord
      - `handleToggleAllRows()` - zaznacz/odznacz wszystkie
      - `handleOpenInsertModal()` - otwÃ³rz modal INSERT
      - `handleOpenUpdateModal(row)` - otwÃ³rz modal UPDATE
      - `handleOpenDeleteModal()` - otwÃ³rz modal DELETE
      - `handleInsertRecord(data)` - wysÅ‚anie POST request
      - `handleUpdateRecord(data)` - wysÅ‚anie PUT request
      - `handleDeleteRecords()` - wysÅ‚anie DELETE request
      - `handleFinishedCellClick(row)` - otwÃ³rz Import dla pojedynczego meczu (NOWY 14.02.2026)
      - `handleUpdateSelected()` - otwÃ³rz Import dla wielu meczÃ³w (NOWY 14.02.2026)
      - `getPrimaryKeyValue(row)` - pomocnik dla PK
    - UI Components:
      - **Checkbox column** - zaznaczanie rekordÃ³w
        - Header checkbox: Select/Deselect all
        - Row checkboxes: individual selection
      - **Actions column** - przyciski Edit ğŸ“ / Delete ğŸ—‘ï¸
        - Sticky position (zawsze widoczna po prawej)
        - Edit button â†’ otwiera UPDATE modal
        - Delete button â†’ otwiera DELETE modal
      - **CRUD Actions buttons** - nad tabelÄ…
        - "â• Insert New Record" (zielony gradient)
        - "ï¿½ Update Selected (X)" (pomaraÅ„czowy gradient) - NOWY 14.02.2026
        - "ï¿½ğŸ—‘ï¸ Delete Selected (X)" (czerwony gradient)
      - **RecordModal** - component dla INSERT/UPDATE
        - Dynamic form based on table schema
        - Type-specific inputs:
          - text/varchar â†’ text input
          - int/numeric â†’ number input
          - date â†’ date picker
          - timestamp â†’ datetime-local
          - boolean â†’ checkbox
          - json â†’ textarea (4 rows)
        - Validation:
          - Required fields (NOT NULL columns)
          - Read-only PK in UPDATE mode
          - Foreign key hints
        - Default values from schema
      - **DeleteModal** - confirmation dialog
        - Shows count of selected records
        - Warning: "This action cannot be undone"
        - Cancel / Delete buttons
    - Selected row highlight (niebieski background)
    - Success/Error alerts
    - Auto-reload po kaÅ¼dej operacji
  - **Zaktualizowano:** `src/pages/DatabasePage.module.css` (897 linii)
    - CRUD styles:
      - `.crudActions` - flex container dla przyciskÃ³w
      - `.btnInsert` - zielony gradient (emerald)
      - `.btnWarning` - pomaraÅ„czowy gradient (amber) - NOWY 14.02.2026
      - `.btnDelete` - czerwony gradient (red)
      - `.btnEdit`, `.btnDeleteSingle` - maÅ‚e przyciski w Actions
      - `.checkboxColumn`, `.checkboxCell` - kolumna checkbox (40px)
      - `.actionsColumn`, `.actionsCell` - kolumna Actions (100px, sticky)
      - `.selectedRow` - niebieski highlight dla zaznaczonych
    - Modal styles:
      - `.modalOverlay` - pÃ³Å‚przezroczyste tÅ‚o (rgba(0,0,0,0.5))
      - `.modalContent` - white card (600px max-width, 80vh max-height)
      - `.modalHeader` - gradient header
      - `.modalBody` - scrollable content
      - `.modalFooter` - flex buttons
      - Animations: fadeIn (overlay), slideInDown (content)
    - Form styles:
      - `.formField`, `.formLabel`, `.formInput`
      - `.formTextarea` - dla JSON columns
      - `.formCheckbox` - dla boolean
      - `.fkHint` - foreign key info
      - `.warningText` - red warning (DELETE modal)
      - `.required` - red asterisk (*)
    - Button styles:
      - `.btnCancel` - white/gray border
      - `.btnSave` - blue gradient
      - `.btnConfirmDelete` - red gradient
      - Hover effects: translateY(-2px) + shadow
- âœ… **Testing & UX**
  - Insert/Update/Delete tested across multiple tables
  - Type-specific inputs render correctly
  - Validation works (required fields, PK constraints)
  - Foreign key hints display properly
  - Bulk delete with checkbox selection works
  - Error handling with user-friendly alerts
  - Loading states during CRUD operations
  - Auto-reload keeps current page/filters
  - Focus preservation maintained

**API Endpoints Table (Updated):**

| Method | Endpoint | Description | Response |
|--------|---------|-------------|----------|
| GET | `/api/database/list` | Lista wszystkich baz danych | `{ databases: DatabaseInfo[], defaultDatabase: string }` |
| GET | `/api/database/:db/tables` | Lista tabel w bazie | `{ tables: TableInfo[] }` |
| GET | `/api/database/:db/tables/:table/schema` | Schemat kolumn tabeli | `TableSchema` (columns, primaryKeys, foreignKeys) |
| POST | `/api/database/:db/tables/:table/query` | Zapytanie z filtrami i sortowaniem | `QueryResult` (rows, totalCount, page, totalPages) |
| POST | `/api/database/:db/tables/:table/insert` | Dodanie nowego rekordu | `{ success: true, record: any }` |
| PUT | `/api/database/:db/tables/:table/update` | Edycja rekordu | `{ success: true, record: any }` |
| DELETE | `/api/database/:db/tables/:table/delete` | UsuniÄ™cie rekordÃ³w | `{ success: true, deletedCount: number }` |

**CRUD Operations Flow:**

```
INSERT:
User â†’ "â• Insert New Record" â†’ RecordModal (form)
  â†’ User fills data â†’ Submit
  â†’ POST /api/database/:db/tables/:table/insert
  â†’ insertRecord(db, table, schema, data)
  â†’ INSERT INTO table (col1, col2) VALUES ($1, $2) RETURNING *
  â†’ Success â†’ loadTableData() (reload)

UPDATE:
User â†’ ğŸ“ Edit button â†’ RecordModal (pre-filled)
  â†’ User edits data â†’ Submit
  â†’ PUT /api/database/:db/tables/:table/update
  â†’ updateRecord(db, table, schema, {column: pk, value: id}, data)
  â†’ UPDATE table SET col1=$1 WHERE pk=$2 RETURNING *
  â†’ Success â†’ loadTableData() (reload)

DELETE:
User â†’ Checkboxes â†’ "ğŸ—‘ï¸ Delete Selected" â†’ DeleteModal (confirmation)
  â†’ User confirms â†’ DELETE request
  â†’ deleteRecords(db, table, schema, {column: pk, values: [id1, id2...]})
  â†’ DELETE FROM table WHERE pk IN ($1, $2, $3...)
  â†’ Success alert â†’ loadTableData() (reload)

BULK UPDATE (Database â†’ Import integration):
User â†’ Checkboxes (multiple matches) â†’ "ğŸ”„ Update Selected" â†’ handleUpdateSelected()
  â†’ Extract: min/max dates, unique (league, country) pairs
  â†’ Build URL: /import?dateFrom=X&dateTo=Y&leagues=L1|K1,L2|K2
  â†’ window.open(url, '_blank') â†’ ImportPage with pre-filled form
```

**NastÄ™pny krok:** Implementacja pozostaÅ‚ych zakÅ‚adek (Wyszukiwarka TypÃ³w, Analityka)

---

## 11.1. INTEGRACJA DATABASE â†’ IMPORT (Bulk Update)

**Data:** 14 lutego 2026

### Cel funkcjonalnoÅ›ci

UmoÅ¼liwienie uÅ¼ytkownikowi szybkiego utworzenia zadania aktualizacji wynikÃ³w dla wielu meczÃ³w bezpoÅ›rednio z zakÅ‚adki Baza Danych, bez rÄ™cznego konfigurowania parametrÃ³w.

### User Story

> "PrzeglÄ…dajÄ…c tabelÄ™ `matches` w Database, uÅ¼ytkownik zaznacza kilka meczÃ³w z rÃ³Å¼nych dat i lig, klika przycisk 'Zaktualizuj wybrane' â†’ automatycznie otwiera siÄ™ nowa karta z zakÅ‚adkÄ… Import i gotowym do utworzenia zadaniem typu 'Aktualizacja wynikÃ³w' z odpowiednimi parametrami (zakres dat + ligi)."

### Implementacja - ImportPage (Primary Agent)

**Plik:** `src/pages/ImportPage.tsx`

#### 1. URL Parameters Support

ImportPage obsÅ‚uguje dwa scenariusze otwierania z parametrami URL:

**Scenariusz A: Single match (istniejÄ…cy)**
```
/import?date=2026-02-14&league=Premier%20League&country=England
```
- UÅ¼ywany przez klikniÄ™cie w komÃ³rkÄ™ `is_finished='no'` w DatabasePage
- Otwiera modal z jednÄ… ligÄ… i jednÄ… datÄ…

**Scenariusz B: Multiple matches (NOWY - 14.02.2026)**
```
/import?dateFrom=2026-02-14&dateTo=2026-02-20&leagues=Premier%20League|England,La%20Liga|Spain
```
- UÅ¼ywany przez przycisk "Zaktualizuj wybrane" w DatabasePage
- Otwiera modal z wieloma ligami i zakresem dat

**Format parametru `leagues`:**
- Format: `Liga1|Kraj1,Liga2|Kraj2,Liga3|Kraj3`
- Separator lig: przecinek `,`
- Separator liga-kraj: pipe `|`
- URL encoding: automatyczne przez `URLSearchParams`

#### 2. Nowe funkcje

**`openModalWithMultipleParams(dateFrom, dateTo, leaguesParam)`**

Logika:
1. Fetch `/api/config` â†’ pobierz listÄ™ wszystkich lig
2. Parse `leaguesParam`: split by `,` â†’ dla kaÅ¼dego split by `|` â†’ find matching league
3. Ustaw stan formularza:
   - `jobType = 'update_results'`
   - `dateFrom = dateFromParam`
   - `dateTo = dateToParam`
   - `selectedLeagues = matchingLeagueIds[]`
4. OtwÃ³rz modal: `setShowModal(true)`

**Rozszerzony `useEffect` (URL params handling)**

```typescript
useEffect(() => {
  // SprawdÅº scenariusz A (multiple)
  if (dateFrom && dateTo && leagues) {
    openModalWithMultipleParams(...)
    return
  }
  
  // SprawdÅº scenariusz B (single)
  if (date && league && country) {
    openModalWithParams(...)
  }
}, [searchParams])
```

#### 3. Zmiany w kodzie

**Import:**
```typescript
import { useSearchParams } from 'react-router-dom'
```

**Stan:**
```typescript
const [searchParams] = useSearchParams()
```

**Funkcje:** (linie ~135-195)
- `openModalWithParams()` - istniejÄ…ca (single match)
- `openModalWithMultipleParams()` - nowa (bulk update)

### Implementacja - DatabasePage (Database Agent)

**Data:** 14 lutego 2026  
**Plik:** `src/pages/DatabasePage.tsx`  
**Linie:** ~890 (przycisk), ~469 (funkcja handleUpdateSelected)

#### 1. Nowy przycisk "Update Selected"

**Lokalizacja:** Linia 890, w sekcji `.crudActions`, przed przyciskiem "Delete Selected"

**Kod:**
```tsx
<button
  className={styles.btnWarning}
  onClick={handleUpdateSelected}
  disabled={loading || selectedRows.size === 0 || selectedTable !== 'matches'}
  title={selectedTable !== 'matches' 
    ? 'This feature only works for the matches table' 
    : `Update results for ${selectedRows.size} selected match(es)`}
>
  ğŸ”„ Update Selected ({selectedRows.size})
</button>
```

**Warunki aktywacji:**
- `selectedTable === 'matches'` (tylko dla tabeli matches)
- `selectedRows.size > 0` (przynajmniej 1 mecz zaznaczony)
- `!loading` (nie podczas Å‚adowania)

**Styl CSS:** `.btnWarning` - pomaraÅ„czowy gradient (#f59e0b â†’ #d97706)

#### 2. Funkcja `handleUpdateSelected()`

**Lokalizacja:** Linia 469, tuÅ¼ po funkcji `handleFinishedCellClick`  
**DÅ‚ugoÅ›Ä‡:** 93 linie  

**Algorytm:**

```typescript
const handleUpdateSelected = () => {
  // 1. Walidacja
  if (selectedTable !== 'matches' || selectedRows.size === 0) return
  if (!queryResult || !tableSchema) return
  
  // 2. Pobierz primary key column
  const pkColumn = tableSchema.primaryKeys[0]
  if (!pkColumn) return
  
  // 3. Filtruj peÅ‚ne obiekty meczÃ³w na podstawie selectedRows (Set<PK>)
  const selectedMatches = queryResult.rows.filter(row => {
    const pkValue = row[pkColumn]
    return selectedRows.has(pkValue)
  })
  
  // 4. WyciÄ…gnij daty i znajdÅº min/max
  const matchDates = selectedMatches
    .map(row => row.match_date)
    .filter(date => date != null)
    .map(date => new Date(date))
  
  const minDate = new Date(Math.min(...matchDates.map(d => d.getTime())))
  const maxDate = new Date(Math.max(...matchDates.map(d => d.getTime())))
  const dateFrom = minDate.toISOString().split('T')[0]
  const dateTo = maxDate.toISOString().split('T')[0]
  
  // 5. Zbierz unikalne pary (league, country)
  const leagueSet = new Map<string, { league: string; country: string }>()
  
  for (const match of selectedMatches) {
    const league = match.league
    const country = match.country
    if (!league || !country) continue
    
    const key = `${league}|${country}`
    if (!leagueSet.has(key)) {
      leagueSet.set(key, { league, country })
    }
  }
  
  // 6. Zbuduj leagues parameter
  const leaguesParam = Array.from(leagueSet.values())
    .map(({ league, country }) => `${league}|${country}`)
    .join(',')
  
  // 7. UtwÃ³rz URL i otwÃ³rz nowÄ… kartÄ™
  const params = new URLSearchParams({
    dateFrom,
    dateTo,
    leagues: leaguesParam
  })
  
  window.open(`/import?${params.toString()}`, '_blank')
}
```

**Kluczowe decyzje techniczne:**

1. **UÅ¼ycie Map dla unikalnych lig:**
   - Key: `"${league}|${country}"` (np. "Premier League|England")
   - Value: `{ league, country }` object
   - Automatycznie eliminuje duplikaty (Å¼adnego dodatkowego sprawdzania)

2. **Znajdowanie min/max dat:**
   - `Math.min(...dates.map(d => d.getTime()))` - timestamp comparison
   - Konwersja do ISO date: `.toISOString().split('T')[0]` â†’ "YYYY-MM-DD"

3. **Filtrowanie rekordÃ³w:**
   - `selectedRows` to `Set<any>` zawierajÄ…cy tylko PK values
   - `queryResult.rows` to `any[]` zawierajÄ…cy peÅ‚ne obiekty
   - Filter: `selectedRows.has(row[pkColumn])`

4. **Alert handling:**
   - "Selected matches have no valid dates" - gdy brak match_date
   - "Selected matches have no valid league/country information" - gdy brak league/country
   - Console errors dla problemÃ³w technicznych (no PK, no queryResult)

**PrzykÅ‚adowy URL output:**
```
/import?dateFrom=2026-02-14&dateTo=2026-02-20&leagues=Premier%20League%7CEngland%2CLa%20Liga%7CSpain%2CBundesliga%7CGermany
```

#### 3. Styl CSS (DatabasePage.module.css)

**Lokalizacja:** Linia 557

```css
.btnWarning {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
}

.btnWarning:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
}

.btnWarning:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

**Design rationale:**
- PomaraÅ„czowy gradient (#f59e0b â†’ #d97706) - amber/warning color
- Hover effect: podniesienie o 2px + wiÄ™kszy cieÅ„
- Disabled: 50% opacity (zgodnie z innymi przyciskami)

---

### Implementacja - DatabasePage (Database Agent)

> âš ï¸ **UWAGA:** CzÄ™Å›Ä‡ DatabasePage jest implementowana przez Database Browser Agent.  
> SzczegÃ³Å‚y w: `Dokumentacja/Instrukcje - agenci/TASK - Bulk Update Selected Matches.md`

**Kluczowe zmiany (overview):**
1. Nowy przycisk "ğŸ”„ Update Selected" obok "ğŸ—‘ï¸ Delete Selected"
2. Funkcja `handleUpdateSelected()` - zbiera dane z zaznaczonych meczÃ³w:
   - Znajduje min/max daty â†’ `dateFrom`, `dateTo`
   - Zbiera unikalne pary `(league, country)` â†’ buduje `leagues` param
   - Otwiera: `window.open(/import?dateFrom=X&dateTo=Y&leagues=...)`
3. Fix timezone: uÅ¼ywa `getFullYear()`, `getMonth()`, `getDate()` (local time) zamiast UTC

**Fix problemu timezone:** (14.02.2026)

PostgreSQL zwraca daty jako UTC timestamps (np. `2026-02-13T23:00:00.000Z` dla 14.02.2026).  
Konwersja przez `new Date()` + local methods poprawnie interpretuje strefÄ™ czasowÄ… uÅ¼ytkownika:

```typescript
const dateObj = new Date(date)  // Parse UTC timestamp
const year = dateObj.getFullYear()  // Returns local year
const day = dateObj.getDate()       // Returns local day
```

### User Flow

```
1. User w zakÅ‚adce Database
   â”œâ”€> Wybiera bazÄ™: bet_assistant
   â”œâ”€> Wybiera tabelÄ™: matches
   â”œâ”€> Zaznacza 5 meczÃ³w (checkboxy):
   â”‚   - 14.02: Premier League / England
   â”‚   - 15.02: La Liga / Spain
   â”‚   - 15.02: Bundesliga / Germany
   â”‚   - 17.02: Premier League / England
   â”‚   - 20.02: Serie A / Italy
   â””â”€> Klika: "ğŸ”„ Update Selected (5)"

2. DatabasePage: handleUpdateSelected()
   â”œâ”€> Zbiera peÅ‚ne obiekty meczÃ³w z queryResult.rows
   â”œâ”€> Znajduje daty: [14.02, 15.02, 17.02, 20.02]
   â”œâ”€> dateFrom = 14.02, dateTo = 20.02
   â”œâ”€> Zbiera ligi: Map { "Premier League|England", "La Liga|Spain", ... }
   â”œâ”€> Buduje URL: /import?dateFrom=2026-02-14&dateTo=2026-02-20&leagues=...
   â””â”€> window.open(url, '_blank')

3. Nowa karta: ImportPage + URL params
   â”œâ”€> useEffect wykrywa: dateFrom + dateTo + leagues
   â”œâ”€> WywoÅ‚uje: openModalWithMultipleParams()
   â”‚   â”œâ”€> Fetch /api/config (lista wszystkich lig)
   â”‚   â”œâ”€> Parse leagues: "Premier League|England,La Liga|Spain,..."
   â”‚   â”œâ”€> Find matching league IDs: [1, 5, 8, 12, 23]
   â”‚   â””â”€> Ustaw stan formularza
   â””â”€> Modal "UtwÃ³rz zadanie" otwarty z:
       - Typ: "Aktualizacja wynikÃ³w"
       - Data od: 2026-02-14
       - Data do: 2026-02-20
       - Ligi: âœ… Premier League, âœ… La Liga, âœ… Bundesliga, âœ… Serie A

4. User klika "UtwÃ³rz" â†’ Zadanie w kolejce
```

### KorzyÅ›ci

- **UX:** Zamiast rÄ™cznego wybierania 4 lig i wpisywania zakresu 7 dni, wszystko automatyczne
- **SzybkoÅ›Ä‡:** 1 klikniÄ™cie zamiast 15+ klikniÄ™Ä‡ w formularzu
- **BezpieczeÅ„stwo:** Tylko mecze juÅ¼ w bazie (nie moÅ¼na pomyliÄ‡ dat/lig)
- **SkalowalnoÅ›Ä‡:** DziaÅ‚a dla 1 meczu, 10 meczÃ³w, 100 meczÃ³w

### Testy

- âœ… Zaznaczenie 1 meczu â†’ otwiera modal z 1 ligÄ… i 1 datÄ…
- âœ… Zaznaczenie 5 meczÃ³w (rÃ³Å¼ne daty) â†’ zakres dat poprawny
- âœ… Zaznaczenie meczÃ³w z 3 lig â†’ wszystkie 3 ligi zaznaczone w modalu
- âœ… Fix timezone: mecze z 14.02 i 15.02 â†’ dateFrom=14.02, dateTo=15.02 (nie 13.02-14.02)
- âœ… URL encoding: spacje w nazwach lig poprawnie zakodowane
- âœ… Ligi duplikaty: mecze z tej samej ligi nie duplikujÄ… siÄ™ w URL

---

## 12. NOTATKI TECHNICZNE

### Performance considerations:

- React.memo dla czÄ™sto renderowanych komponentÃ³w
- useMemo / useCallback dla drogich obliczeÅ„
- Code splitting (React.lazy) dla stron
- TanStack Query caching dla API calls

### Security considerations:

- Backend obsÅ‚uguje auth (jeÅ›li jest)
- Frontend nie przechowuje sensitywnych danych
- HTTPS w produkcji

### Browser support:

- Modern browsers (Chrome, Firefox, Edge, Safari)
- ES2020+ features
- No IE11 support

---

**Ostatnia aktualizacja:** 14 lutego 2026  
**Autor dokumentacji:** AI Agent (Migracja + Database Browser Implementation)
