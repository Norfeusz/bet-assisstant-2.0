================================================================================
    AUTOMATYCZNE PRZENOSZENIE TYPÃ“W DO STREFY TYPERA
    Instrukcje dla agenta w drugim projekcie
================================================================================

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    1. CO TO JEST I JAK DZIAÅA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FUNKCJA:
Automatyczne dodawanie najlepszych typÃ³w z wyszukiwania Bet Finder do arkusza
Google Sheets "Bet Builder" (Strefa Typera).

PRZEPÅYW DZIAÅANIA:
1. UÅ¼ytkownik uruchamia wyszukiwanie w Bet Finder (np. "NajwiÄ™cej bramek")
2. System znajduje TOP X wynikÃ³w (np. TOP 10)
3. UÅ¼ytkownik klika przycisk "Auto-Add" w modalu z wynikami
4. Frontend wysyÅ‚a kaÅ¼dy mecz do backendu
5. Backend:
   - Oblicza statystyki dla meczu (5/10/15 ostatnich meczÃ³w)
   - Oblicza procentowÄ… szansÄ™ na trafienie zakÅ‚adu
   - Sprawdza czy szansa >= 60%
   - JeÅ›li TAK â†’ dodaje do Google Sheets
   - JeÅ›li NIE â†’ pomija (skip)

ZASADY IMPORTU:
âœ“ Tylko typy gdzie obliczona szansa >= 60%
âœ“ Minimum 4 wartoÅ›ci statystycznych wymagane (inaczej "za maÅ‚o danych")
âœ“ Najkorzystniejsze kursy (TOP wyniki z wyszukiwania)
âœ“ Automatyczne obliczanie statystyk dla 5/10/15 meczÃ³w (overall + H/A)
âœ“ Duplikaty nie sÄ… sprawdzane - kaÅ¼de wywoÅ‚anie dodaje nowy wiersz

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    2. LOKALIZACJE PLIKÃ“W W NASZYM PROJEKCIE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

W kopii starego projektu (./stary/) znajdziesz:

FRONTEND - LOGIKA AUTO-ADD:
ğŸ“ stary/public/js/bet-finder.js
   â””â”€ Linia ~2903: funkcja autoAddResultsToBetBuilder(results, modalType)
      â€¢ GÅ‚Ã³wna funkcja auto-add
      â€¢ Iteruje przez wyniki wyszukiwania
      â€¢ Åaduje konfiguracjÄ™ z modal-types-config.json
      â€¢ Mapuje typ wyszukiwania na typ zakÅ‚adu (betType + betOption)
      â€¢ WysyÅ‚a kaÅ¼dy mecz do backendu (/api/strefa-typera/add-match-bet-builder)
      â€¢ Pokazuje podsumowanie (dodane/pominiÄ™te/bÅ‚Ä™dy)

ğŸ“ stary/public/js/app.js
   â””â”€ Linia ~4123: funkcja showAutoAddTypesModal()
      â€¢ Modal z wyborem typÃ³w wyszukiwaÅ„ do auto-add
      â€¢ Checkboxy dla kaÅ¼dego typu (bramki, roÅ¼ne, etc.)
      â€¢ Przycisk "Dodaj wszystkie" vs "Dodaj wybrane"
   
   â””â”€ Linia ~4250: funkcja startAutoAddTypes(mode)
      â€¢ Ustawia flagÄ™ window.autoAddToBetBuilder = true
      â€¢ OkreÅ›la ktÃ³re typy modali majÄ… byÄ‡ auto-dodawane
      â€¢ Uruchamia serie wyszukiwaÅ„

   â””â”€ Linia ~2800: integracja auto-add w showModal
      â€¢ Sprawdza czy auto-add jest aktywny
      â€¢ Automatycznie wywoÅ‚uje autoAddResultsToBetBuilder dla wynikÃ³w

BACKEND - OBLICZENIA I ZAPIS:
ğŸ“ stary/server/routes/strefa-typera.ts
   â””â”€ Linia ~450-600: endpoint POST /strefa-typera/add-match-bet-builder
      â€¢ Przyjmuje: homeTeam, awayTeam, league, date, betType, betOption
      â€¢ Znajduje mecz w bazie danych
      â€¢ WywoÅ‚uje calculateBetStatistics() dla 5/10/15 meczÃ³w
      â€¢ Oblicza Å›redniÄ… szansÄ™ (kolumna E w arkuszu):
        - Bierze wartoÅ›ci z kolumn H-O (8 wartoÅ›ci)
        - Filtruje tylko numeryczne (ignoruje "za maÅ‚o danych")
        - JeÅ›li < 4 wartoÅ›ci â†’ "za maÅ‚o danych"
        - JeÅ›li >= 4 wartoÅ›ci â†’ Å›rednia arytmetyczna
      â€¢ Sprawdza warunek: szansa >= 60%
      â€¢ JeÅ›li speÅ‚niony â†’ appenduje wiersz do Google Sheets
      â€¢ JeÅ›li nie â†’ zwraca {skipped: true, skipReason: "..."}

   â””â”€ Linia ~567: walidacja progu 60%
      if (percentValue < 60) {
          shouldAdd = false
          skipReason = `szansa < 60% (${percentValue}%)`
      }

KONFIGURACJA TYPÃ“W:
ğŸ“ stary/public/modal-types-config.json
   â€¢ Mapowanie typÃ³w wyszukiwaÅ„ na zakÅ‚ady
   â€¢ KaÅ¼dy typ ma:
     - type: nazwa typu (np. "NajwiÄ™cej bramek (mecz)")
     - betCondition: warunek wyboru zakÅ‚adu
     - betIfTrue/betIfFalse: typ zakÅ‚adu (np. "1", "2", "Over", "BTS")
     - typeIfTrue/typeIfFalse: opcja zakÅ‚adu (np. "2.5", "-1.5")
     - group: kategoria (Bramki, RoÅ¼ne, etc.)
     - uiFunctionName: nazwa funkcji UI

   PrzykÅ‚ad:
   {
     "type": "NajwiÄ™cej bramek (mecz)",
     "betIfTrue": "Over",
     "typeIfTrue": "2.5",
     "betIfFalse": "-",
     "typeIfFalse": "-"
   }

UTILITY - OBLICZENIA STATYSTYK:
ğŸ“ stary/server/utils/bet-statistics.ts
   â””â”€ calculateBetStatistics(homeTeam, awayTeam, betType, betOption, mode, league, limit)
      â€¢ Pobiera ostatnie X meczÃ³w dla kaÅ¼dej druÅ¼yny
      â€¢ mode: 'overall' (wszystkie mecze) lub 'ha' (home/away)
      â€¢ limit: 5, 10, lub 15
      â€¢ Zwraca: homePercentage, awayPercentage (lub "za maÅ‚o danych")

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    3. KLUCZOWE ALGORYTMY DO ZROZUMIENIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBLICZANIE SZANSY (kolumna E w arkuszu):
-----------------------------------------
// Backend: strefa-typera.ts, linia ~110-140

const percentages = [
    stats5Overall.homePercentage,   // H
    stats5Overall.awayPercentage,   // I
    stats5Ha.homePercentage,        // J
    stats5Ha.awayPercentage,        // K
    stats10Overall.homePercentage,  // L
    stats10Overall.awayPercentage,  // M
    stats10Ha.homePercentage,       // N
    stats10Ha.awayPercentage,       // O
]

// Tylko numeryczne wartoÅ›ci
const validPercentages = percentages.filter(p => typeof p === 'number')

if (validPercentages.length < 4) {
    szanse = 'za maÅ‚o danych'
} else {
    const average = sum(validPercentages) / validPercentages.length
    szanse = average.toFixed(1).replace('.', ',') + '%'
}

WALIDACJA PRZED DODANIEM:
-----------------------------------------
// Backend: strefa-typera.ts, linia ~556-570

if (szanse === 'za maÅ‚o danych') {
    shouldAdd = false
    skipReason = 'za maÅ‚o danych'
} else {
    const percentValue = parseFloat(szanse.replace(',', '.').replace('%', ''))
    if (percentValue < 60) {
        shouldAdd = false
        skipReason = `szansa < 60% (${percentValue}%)`
    }
}

if (shouldAdd) {
    // Dodaj do Google Sheets
} else {
    // ZwrÃ³Ä‡ {skipped: true, skipReason}
}

MAPOWANIE TYPU WYSZUKIWANIA NA ZAKÅAD:
-----------------------------------------
// Frontend: bet-finder.js, linia ~2910-2950

// 1. ZaÅ‚aduj config
const config = await loadModalTypesConfig()

// 2. Zmapuj modalType na nazwÄ™ w JSON
const searchTypeMap = {
    'most-goals': 'NajwiÄ™cej bramek (mecz)',
    'most-bts': 'NajwiÄ™cej BTS',
    'home-wins': 'ZwyciÄ™stwa gospodarzy',
    // ... etc
}
const typeName = searchTypeMap[modalType]

// 3. ZnajdÅº wszystkie konfiguracje dla tego typu
const modalConfigs = config.modalTypes.filter(c => c.type === typeName)

// 4. Dla kaÅ¼dej konfiguracji okreÅ›l betType i betOption
for (const modalConfig of modalConfigs) {
    const conditionResult = evaluateCondition(modalConfig.betCondition, result)
    
    if (conditionResult) {
        betType = modalConfig.betIfTrue
        betOption = modalConfig.typeIfTrue
    } else {
        betType = modalConfig.betIfFalse
        betOption = modalConfig.typeIfFalse
    }
    
    // WyÅ›lij do backendu
    fetch('/api/strefa-typera/add-match-bet-builder', {
        body: JSON.stringify({
            homeTeam, awayTeam, league, date,
            betType, betOption, odds: ''
        })
    })
}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    4. STRUKTURA DANYCH - CO JEST PRZENOSZONE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

REQUEST DO BACKENDU:
{
  homeTeam: "Manchester United",
  awayTeam: "Liverpool",
  league: "Premier League",
  date: "2025-01-15",
  betType: "Over",           // np. "1", "2", "Over", "BTS", "Handi 1"
  betOption: "2.5",           // np. "-", "2.5", "-1.5", "Tak"
  odds: "",                   // Pusty dla auto-add (obliczone pÃ³Åºniej)
  superbetLink: "https://...",
  flashscoreLink: "https://..."
}

RESPONSE Z BACKENDU (sukces):
{
  success: true,
  message: "Added 1 row to Bet Builder",
  rowsAdded: 1,
  homeTeam: "Manchester United",
  awayTeam: "Liverpool",
  betType: "Over",
  betOption: "2.5",
  odds: "",
  szanse: "65,5%",           // Lub "za maÅ‚o danych"
  matchId: 12345
}

RESPONSE Z BACKENDU (pominiÄ™ty):
{
  success: false,
  skipped: true,
  skipReason: "szansa < 60% (45.2%)"  // Lub "za maÅ‚o danych"
}

WIERSZ W GOOGLE SHEETS (kolumny A-AR):
A: home_team
B: away_team
C: betType (zakÅ‚ad)
D: betOption (typ)
E: szanse (obliczona Å›rednia %)
F: odds (kurs - pusty dla auto-add)
G: moc bet (=E*F, obliczane w arkuszu)
H-O: statystyki 5/10 meczÃ³w (8 kolumn)
P-S: statystyki 15 meczÃ³w (4 kolumny)
T-W: wyniki (rÄ™czne wypeÅ‚nienie pÃ³Åºniej)
X-Y: standing home/away
Z: komentarz
AA-AB: kraj, liga
AC: data meczu
AD: ID meczu
AE: ID kuponu
AF-AG: linki (Superbet, Flashscore)
AH-AI: rezerwowe
AJ-AQ: Team Chance statistics (8 kolumn)
AR: Szansa druÅ¼yna

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    5. PRZYKÅADOWY FLOW KROK PO KROKU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. UÅ¼ytkownik klika "NajwiÄ™cej bramek" w Bet Finder
   â†’ queueMostGoals() â†’ findMatches() â†’ showMostGoalsModal(results)

2. Modal pokazuje TOP 10 wynikÃ³w
   â†’ Przycisk "ğŸ”„ Auto-Add" dostÄ™pny w nagÅ‚Ã³wku

3. UÅ¼ytkownik klika "Auto-Add"
   â†’ autoAddResultsToBetBuilder(results, 'most-goals')

4. Funkcja iteruje przez 10 wynikÃ³w:
   For each match:
     a) Åaduje modal-types-config.json
     b) Mapuje 'most-goals' â†’ "NajwiÄ™cej bramek (mecz)"
     c) Znajduje config: {betIfTrue: "Over", typeIfTrue: "2.5"}
     d) POST /api/strefa-typera/add-match-bet-builder
        {homeTeam, awayTeam, betType: "Over", betOption: "2.5"}

5. Backend dla kaÅ¼dego meczu:
   a) Znajduje mecz w bazie: findFirst({home_team, away_team, match_date})
   b) Oblicza statystyki:
      - stats5Overall, stats5Ha
      - stats10Overall, stats10Ha
      - stats15Overall, stats15Ha
   c) Oblicza szansÄ™: Å›rednia z 8 wartoÅ›ci (H-O)
   d) Sprawdza: szanse >= 60% i min 4 wartoÅ›ci?
   e) JeÅ›li TAK â†’ append do Google Sheets
      JeÅ›li NIE â†’ skip i zwrÃ³Ä‡ powÃ³d

6. Frontend pokazuje toast:
   "âœ… Automatycznie dodano 7 zakÅ‚adÃ³w"
   "âš ï¸ PominiÄ™to 3 zakÅ‚ady (szansa < 60%)"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    6. CO NALEÅ»Y ZMIGROWAÄ† DO NOWEGO PROJEKTU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FRONTEND (React):
â–¡ Przycisk "Auto-Add" w modalu wynikÃ³w
â–¡ Funkcja autoAddResultsToBetBuilder() â†’ hook useAutoAddBets()
â–¡ Modal wyboru typÃ³w do auto-add (opcjonalne na poczÄ…tek)
â–¡ Toast notifications dla progress i wynikÃ³w
â–¡ Loading state podczas dodawania

BACKEND:
â–¡ Endpoint juÅ¼ istnieje - nie trzeba zmieniaÄ‡
â–¡ Upewnij siÄ™ Å¼e /api/strefa-typera/add-match-bet-builder dziaÅ‚a

KONFIGURACJA:
â–¡ Skopiuj modal-types-config.json do nowego projektu
â–¡ UtwÃ³rz TypeScript types dla konfiguracji

PROPOZYCJA STRUKTURY:
src/hooks/useAutoAddBets.ts          - logika auto-add
src/api/strefaTypera.ts              - API calls
src/types/betTypes.ts                - TypeScript interfaces
src/config/modalTypes.ts             - export config (z JSON)
src/components/AutoAddButton.tsx     - przycisk w modalu

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    7. NAJWAÅ»NIEJSZE DO ZAPAMIÄ˜TANIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ PrÃ³g 60% jest TWARDY - niÅ¼sze szanse sÄ… pomijane
âœ“ Minimum 4 wartoÅ›ci statystycznych wymagane
âœ“ Backend oblicza szansÄ™ jako Å›redniÄ… z kolumn H-O (8 wartoÅ›ci)
âœ“ Modal-types-config.json jest KLUCZOWY - mapuje wyszukiwania na zakÅ‚ady
âœ“ Jeden typ wyszukiwania moÅ¼e mieÄ‡ WIELE konfiguracji zakÅ‚adÃ³w
âœ“ Backend automatycznie pomija niepasujÄ…ce typy (zwraca skip: true)
âœ“ Frontend pokazuje podsumowanie: dodane/pominiÄ™te/bÅ‚Ä™dy
âœ“ Google Sheets jest aktualizowany przez backend (nie frontend)

================================================================================
    KONIEC INSTRUKCJI
    Powodzenia w implementacji! âš½
================================================================================
